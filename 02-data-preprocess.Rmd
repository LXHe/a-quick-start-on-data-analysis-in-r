---
output:
  # pdf_document: default
  html_document: default
---

# 数据导入、导出与预处理
## 数据导入
### CSV文件读取
CSV（comma-separated values）文件是以`.csv`结尾的文件，文件中的数据以`,`分隔，每一行代表一条记录。如

![](./img/chapter2-csv.png)

读取csv文件或者以类似格式存储数据的txt文件时，可以使用`read.csv()`函数。

***注意***：在输入文件路径时，需要使用`\\`或者`/`。
```{r chapter2-load-csv}
# 读取数据
wine_df <- read.csv("data/wine.csv") # 或者 read.csv("data\\wine.csv")

# 显示前5行记录
head(wine_df, 5)
```
在上例中可以看到，`read.csv()`默认将第一行记录读取为变量名。如果不将第一行读取为变量名
，可以声明参数`header=FALSE`，这时，变量名将自动生成（“V1”,“V2”...）。
```{r chapter2-load-csv-2}
# 读取数据
wine_df <- read.csv("data/wine.csv", header=FALSE)

# 显示前5行记录
head(wine_df, 5)
```
有些文件中的数据会以`,`当做千位分隔符，数据以`;`分隔，这时可以用`read.csv2()`函数。
```{r chapter2-load-csv-3}
# 读取数据
revenue_df <- read.csv2("data/revenue.txt")

# 显示前5行记录
head(revenue_df, 5)
```
### excel文件读取
excel文件的读取可以使用`readxl`包的`read_excel()`函数。此函数默认读取第一个工作表，如果需要读取特定工作表，可以声明`sheet`变量。
```{r chapter2-excel}
library(readxl)
goods_df <- read_excel("data/goods.xlsx")
head(goods_df,5)
```

读取一个excel文件中的多个工作表。
```{r chapter2-excel-2}
sheets <- excel_sheets("data/goods.xlsx") # 返回"goods.xlsx"工作表名称
multi_df <- lapply(sheets, function(x){read_excel("data/goods.xlsx", sheet=x)}) # 读取每个工作表为数据框并返回列表
names(multi_df) <- sheets # 给列表的元素命名
length(multi_df) # 查看生成的列表长度（每个元素对应一个工作表）
head(multi_df$Year2020,3) # 查看Year2020工作表对应的数据
```

### 文件读取汇总
|文件类型|调用包|读取函数|
|:---|:---|:---|
|CSV文件（*.csv）|utils（R自带）|read.csv()|
|TXT文件（*.txt）|utils（R自带）|read.csv()|
|excel文件（\*.xlsx或\*.xls）|readxl|read_excel()|
|SAS文件（*.sas7bdat）|haven|read.sas()|
|SPSS文件（*.sav）|haven|read.sav()|
|STATA文件（*.dta）|haven|read_dta()|

## 数据导出
|数据导出类型|导出时调用包|导出函数|读取时调用包|读取函数|
|:---|:---|:---|:---|:---|
|R数据文件（*.Rdata）|base（R自带）|save()|base（R自带）|load()|
|CSV文件（*.csv）|utils（R自带）|write.csv()|utils（R自带）|read.csv()|
|自定义文件（\*.csv或\*.txt）|utils（R自带）|write.table()|utils（R自带）|read.csv()|
|excel文件（*.xlsx）|WriteXLS|WriteXLS()|readxl|read_excel()|

```{r chapter2-export}
# 将goods_df导出为goods.csv文件，导出位置为D盘
write.csv(goods_df, "D:/goods.csv", row.names=FALSE) # row.names=FALSE时将不会导出数据索引值
```

## 路径
我们在读取文件时，可以使用文件完整的存储路径，比如`D:/a-quick-start-on-data-analysis-in-r/data/goods.xlsx`，它能帮助我们找到任意位置上的文件，这条路径被称**绝对路径（absolute directory）**。

有时，文件的绝对路径很长，而且我们需要处理的文件一般都集中在特定文件夹下，这时，为了避免代码冗长，我们可以先设定一个工作路径，告诉R在查找文件时只查找存储在这个工作路径下的文件。这样，当我们要调用特定文件时，只需要调用该文件在<u>当前工作路径</u>下的路径，这条路径被称为**相对路径（relative directory）**。例如，当我们将`D:/a-quick-start-on-data-analysis-in-r`设置为工作路径，这时，如果要调用`goods.xlsx`，只需要输入路径`data/goods.xlsx`即可。

我们可以使用`getwd()`函数来获取当前的工作路径，使用`setwd()`设置新的工作路径。

***注意***：
<li>在设置了工作路径后，数据或图片的**存储**与**读取**都会默认在<u>该工作路径</u>下进行。</li>
<li>需要读取存储在其它路径的数据时，需要使用**绝对路径**。</li>

有时，我们需要对特定文件夹下面的特定类型（或者特定名称）文件进行批量读取，可以通过`list.files()`函数实现。

```{r chapter2-directory}
# 获取data文件夹下的所有txt文件名
file_names <- list.files(path="data", pattern="\\.txt")
file_names
```