<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第2章 数据导入、导出与预处理 | R数据分析入门</title>
  <meta name="description" content="This is a textbook for a quick start on data analysis in R." />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="第2章 数据导入、导出与预处理 | R数据分析入门" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a textbook for a quick start on data analysis in R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第2章 数据导入、导出与预处理 | R数据分析入门" />
  
  <meta name="twitter:description" content="This is a textbook for a quick start on data analysis in R." />
  

<meta name="author" content="Lingxiao HE" />


<meta name="date" content="2024-04-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="基本介绍.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R数据分析入门</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本书说明</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#软件准备"><i class="fa fa-check"></i>软件准备</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r包的安装与调用"><i class="fa fa-check"></i>R包的安装与调用</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="基本介绍.html"><a href="基本介绍.html"><i class="fa fa-check"></i><b>1</b> 基本介绍</a>
<ul>
<li class="chapter" data-level="1.1" data-path="基本介绍.html"><a href="基本介绍.html#变量赋值"><i class="fa fa-check"></i><b>1.1</b> 变量赋值</a></li>
<li class="chapter" data-level="1.2" data-path="基本介绍.html"><a href="基本介绍.html#数据类型"><i class="fa fa-check"></i><b>1.2</b> 数据类型</a></li>
<li class="chapter" data-level="1.3" data-path="基本介绍.html"><a href="基本介绍.html#chapter1-label-vector"><i class="fa fa-check"></i><b>1.3</b> 向量</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="基本介绍.html"><a href="基本介绍.html#按逻辑进行向量选择"><i class="fa fa-check"></i><b>1.3.1</b> 按逻辑进行向量选择</a></li>
<li class="chapter" data-level="1.3.2" data-path="基本介绍.html"><a href="基本介绍.html#向量的极值"><i class="fa fa-check"></i><b>1.3.2</b> 向量的极值</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="基本介绍.html"><a href="基本介绍.html#缺失值"><i class="fa fa-check"></i><b>1.4</b> 缺失值</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="基本介绍.html"><a href="基本介绍.html#nan"><i class="fa fa-check"></i><b>1.4.1</b> NaN</a></li>
<li class="chapter" data-level="1.4.2" data-path="基本介绍.html"><a href="基本介绍.html#null"><i class="fa fa-check"></i><b>1.4.2</b> NULL</a></li>
<li class="chapter" data-level="1.4.3" data-path="基本介绍.html"><a href="基本介绍.html#na"><i class="fa fa-check"></i><b>1.4.3</b> NA</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="基本介绍.html"><a href="基本介绍.html#chapter1-label-matrix"><i class="fa fa-check"></i><b>1.5</b> 矩阵</a></li>
<li class="chapter" data-level="1.6" data-path="基本介绍.html"><a href="基本介绍.html#数据框"><i class="fa fa-check"></i><b>1.6</b> 数据框</a></li>
<li class="chapter" data-level="1.7" data-path="基本介绍.html"><a href="基本介绍.html#数组"><i class="fa fa-check"></i><b>1.7</b> 数组</a></li>
<li class="chapter" data-level="1.8" data-path="基本介绍.html"><a href="基本介绍.html#列表"><i class="fa fa-check"></i><b>1.8</b> 列表</a></li>
<li class="chapter" data-level="1.9" data-path="基本介绍.html"><a href="基本介绍.html#字符串处理"><i class="fa fa-check"></i><b>1.9</b> 字符串处理</a></li>
<li class="chapter" data-level="1.10" data-path="基本介绍.html"><a href="基本介绍.html#常用函数"><i class="fa fa-check"></i><b>1.10</b> 常用函数</a>
<ul>
<li class="chapter" data-level="1.10.1" data-path="基本介绍.html"><a href="基本介绍.html#seq函数"><i class="fa fa-check"></i><b>1.10.1</b> seq()函数</a></li>
<li class="chapter" data-level="1.10.2" data-path="基本介绍.html"><a href="基本介绍.html#rep函数"><i class="fa fa-check"></i><b>1.10.2</b> rep()函数</a></li>
<li class="chapter" data-level="1.10.3" data-path="基本介绍.html"><a href="基本介绍.html#unique函数"><i class="fa fa-check"></i><b>1.10.3</b> unique()函数</a></li>
<li class="chapter" data-level="1.10.4" data-path="基本介绍.html"><a href="基本介绍.html#quantile函数"><i class="fa fa-check"></i><b>1.10.4</b> quantile()函数</a></li>
<li class="chapter" data-level="1.10.5" data-path="基本介绍.html"><a href="基本介绍.html#floorceilinground函数"><i class="fa fa-check"></i><b>1.10.5</b> floor()、ceiling()、round()函数</a></li>
<li class="chapter" data-level="1.10.6" data-path="基本介绍.html"><a href="基本介绍.html#sample函数"><i class="fa fa-check"></i><b>1.10.6</b> sample()函数</a></li>
<li class="chapter" data-level="1.10.7" data-path="基本介绍.html"><a href="基本介绍.html#combn函数"><i class="fa fa-check"></i><b>1.10.7</b> combn()函数</a></li>
<li class="chapter" data-level="1.10.8" data-path="基本介绍.html"><a href="基本介绍.html#paste函数"><i class="fa fa-check"></i><b>1.10.8</b> paste()函数</a></li>
<li class="chapter" data-level="1.10.9" data-path="基本介绍.html"><a href="基本介绍.html#chapter1-label-ifelse"><i class="fa fa-check"></i><b>1.10.9</b> ifelse()函数</a></li>
<li class="chapter" data-level="1.10.10" data-path="基本介绍.html"><a href="基本介绍.html#chapter1-label-if-else"><i class="fa fa-check"></i><b>1.10.10</b> if(){}else{}函数</a></li>
<li class="chapter" data-level="1.10.11" data-path="基本介绍.html"><a href="基本介绍.html#循环"><i class="fa fa-check"></i><b>1.10.11</b> 循环</a></li>
<li class="chapter" data-level="1.10.12" data-path="基本介绍.html"><a href="基本介绍.html#自定义函数"><i class="fa fa-check"></i><b>1.10.12</b> 自定义函数</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html"><i class="fa fa-check"></i><b>2</b> 数据导入、导出与预处理</a>
<ul>
<li class="chapter" data-level="2.1" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#数据导入"><i class="fa fa-check"></i><b>2.1</b> 数据导入</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#csv文件读取"><i class="fa fa-check"></i><b>2.1.1</b> CSV文件读取</a></li>
<li class="chapter" data-level="2.1.2" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#excel文件读取"><i class="fa fa-check"></i><b>2.1.2</b> excel文件读取</a></li>
<li class="chapter" data-level="2.1.3" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#文件读取汇总"><i class="fa fa-check"></i><b>2.1.3</b> 文件读取汇总</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#数据导出"><i class="fa fa-check"></i><b>2.2</b> 数据导出</a></li>
<li class="chapter" data-level="2.3" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#路径"><i class="fa fa-check"></i><b>2.3</b> 路径</a></li>
<li class="chapter" data-level="2.4" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#数据预处理"><i class="fa fa-check"></i><b>2.4</b> 数据预处理</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#tidyverse包"><i class="fa fa-check"></i><b>2.4.1</b> tidyverse包</a></li>
<li class="chapter" data-level="2.4.2" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#批量读取数据"><i class="fa fa-check"></i><b>2.4.2</b> 批量读取数据</a></li>
<li class="chapter" data-level="2.4.3" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#数据合并"><i class="fa fa-check"></i><b>2.4.3</b> 数据合并</a></li>
<li class="chapter" data-level="2.4.4" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#数据清洗"><i class="fa fa-check"></i><b>2.4.4</b> 数据清洗</a></li>
<li class="chapter" data-level="2.4.5" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#数据整理"><i class="fa fa-check"></i><b>2.4.5</b> 数据整理</a></li>
<li class="chapter" data-level="2.4.6" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#删除重复记录"><i class="fa fa-check"></i><b>2.4.6</b> 删除重复记录</a></li>
<li class="chapter" data-level="2.4.7" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#按条件筛选记录"><i class="fa fa-check"></i><b>2.4.7</b> 按条件筛选记录</a></li>
<li class="chapter" data-level="2.4.8" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#按条件创建变量"><i class="fa fa-check"></i><b>2.4.8</b> 按条件创建变量</a></li>
<li class="chapter" data-level="2.4.9" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#chapter2-label-summarise"><i class="fa fa-check"></i><b>2.4.9</b> 汇总函数summarise()与reframe()</a></li>
<li class="chapter" data-level="2.4.10" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#across函数"><i class="fa fa-check"></i><b>2.4.10</b> across()函数</a></li>
<li class="chapter" data-level="2.4.11" data-path="数据导入导出与预处理.html"><a href="数据导入导出与预处理.html#日期处理"><i class="fa fa-check"></i><b>2.4.11</b> 日期处理</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R数据分析入门</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="数据导入导出与预处理" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">第2章</span> 数据导入、导出与预处理<a href="数据导入导出与预处理.html#数据导入导出与预处理" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="数据导入" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> 数据导入<a href="数据导入导出与预处理.html#数据导入" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="csv文件读取" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> CSV文件读取<a href="数据导入导出与预处理.html#csv文件读取" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>CSV（comma-separated values）文件是以<code>.csv</code>结尾的文件，文件中的数据以<code>,</code>分隔，每一行代表一条记录。如</p>
<p><img src="img/chapter2-csv.png" /></p>
<p>读取csv文件或者以类似格式存储数据的txt文件时，可以使用<code>read.csv()</code>函数。</p>
<p><strong><em>注意</em></strong>：在输入文件路径时，需要使用<code>\\</code>或者<code>/</code>。</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="数据导入导出与预处理.html#cb267-1" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb267-2"><a href="数据导入导出与预处理.html#cb267-2" tabindex="-1"></a>wine_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/wine.csv&quot;</span>) <span class="co"># 或者 read.csv(&quot;data\\wine.csv&quot;)</span></span>
<span id="cb267-3"><a href="数据导入导出与预处理.html#cb267-3" tabindex="-1"></a></span>
<span id="cb267-4"><a href="数据导入导出与预处理.html#cb267-4" tabindex="-1"></a><span class="co"># 显示前5行记录</span></span>
<span id="cb267-5"><a href="数据导入导出与预处理.html#cb267-5" tabindex="-1"></a><span class="fu">head</span>(wine_df, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   X1 X14.23 X1.71 X2.43
## 1  1  13.20  1.78  2.14
## 2  1  13.16  2.36  2.67
## 3  1  14.37  1.95  2.50
## 4  1  13.24  2.59  2.87
## 5  1  14.20  1.76  2.45</code></pre>
<p>在上例中可以看到，<code>read.csv()</code>默认将第一行记录读取为变量名。如果不将第一行读取为变量名 ，可以声明参数<code>header=FALSE</code>，这时，变量名将自动生成（“V1”,“V2”…）。</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="数据导入导出与预处理.html#cb269-1" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb269-2"><a href="数据导入导出与预处理.html#cb269-2" tabindex="-1"></a>wine_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/wine.csv&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>)</span>
<span id="cb269-3"><a href="数据导入导出与预处理.html#cb269-3" tabindex="-1"></a></span>
<span id="cb269-4"><a href="数据导入导出与预处理.html#cb269-4" tabindex="-1"></a><span class="co"># 显示前5行记录</span></span>
<span id="cb269-5"><a href="数据导入导出与预处理.html#cb269-5" tabindex="-1"></a><span class="fu">head</span>(wine_df, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   V1    V2   V3   V4
## 1  1 14.23 1.71 2.43
## 2  1 13.20 1.78 2.14
## 3  1 13.16 2.36 2.67
## 4  1 14.37 1.95 2.50
## 5  1 13.24 2.59 2.87</code></pre>
<p>有些文件中的数据会以<code>,</code>当做千位分隔符，数据以<code>;</code>分隔，这时可以用<code>read.csv2()</code>函数。</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="数据导入导出与预处理.html#cb271-1" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb271-2"><a href="数据导入导出与预处理.html#cb271-2" tabindex="-1"></a>revenue_df <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">&quot;data/revenue.txt&quot;</span>)</span>
<span id="cb271-3"><a href="数据导入导出与预处理.html#cb271-3" tabindex="-1"></a></span>
<span id="cb271-4"><a href="数据导入导出与预处理.html#cb271-4" tabindex="-1"></a><span class="co"># 显示前5行记录</span></span>
<span id="cb271-5"><a href="数据导入导出与预处理.html#cb271-5" tabindex="-1"></a><span class="fu">head</span>(revenue_df, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   company revenue other_income
## 1       A  10.114        2.102
## 2       B  18.723        4.055
## 3       C  20.266        6.314
## 4       D  36.844        5.084
## 5       E  59.711        9.430</code></pre>
</div>
<div id="excel文件读取" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> excel文件读取<a href="数据导入导出与预处理.html#excel文件读取" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>excel文件的读取可以使用<code>readxl</code>包的<code>read_excel()</code>函数。此函数默认读取第一个工作表，如果需要读取特定工作表，可以声明<code>sheet</code>变量。</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="数据导入导出与预处理.html#cb273-1" tabindex="-1"></a><span class="co"># 加载包</span></span>
<span id="cb273-2"><a href="数据导入导出与预处理.html#cb273-2" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb273-3"><a href="数据导入导出与预处理.html#cb273-3" tabindex="-1"></a></span>
<span id="cb273-4"><a href="数据导入导出与预处理.html#cb273-4" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb273-5"><a href="数据导入导出与预处理.html#cb273-5" tabindex="-1"></a>goods_df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;data/goods.xlsx&quot;</span>)</span>
<span id="cb273-6"><a href="数据导入导出与预处理.html#cb273-6" tabindex="-1"></a></span>
<span id="cb273-7"><a href="数据导入导出与预处理.html#cb273-7" tabindex="-1"></a><span class="co"># 显示前5行记录</span></span>
<span id="cb273-8"><a href="数据导入导出与预处理.html#cb273-8" tabindex="-1"></a><span class="fu">head</span>(goods_df,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   country     continent amount
##   &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;
## 1 Afghanistan Asia          11
## 2 Albania     Europe        30
## 3 Algeria     Africa        49
## 4 Andorra     Europe        55
## 5 Bahrain     Asia          20</code></pre>
<p>读取一个excel文件中的多个工作表。</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="数据导入导出与预处理.html#cb275-1" tabindex="-1"></a><span class="co"># 返回&quot;goods.xlsx&quot;工作表名称</span></span>
<span id="cb275-2"><a href="数据导入导出与预处理.html#cb275-2" tabindex="-1"></a>sheets <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(<span class="st">&quot;data/goods.xlsx&quot;</span>) </span>
<span id="cb275-3"><a href="数据导入导出与预处理.html#cb275-3" tabindex="-1"></a></span>
<span id="cb275-4"><a href="数据导入导出与预处理.html#cb275-4" tabindex="-1"></a><span class="co"># 读取每个工作表为数据框并返回列表</span></span>
<span id="cb275-5"><a href="数据导入导出与预处理.html#cb275-5" tabindex="-1"></a>multi_df <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sheets, <span class="cf">function</span>(x){<span class="fu">read_excel</span>(<span class="st">&quot;data/goods.xlsx&quot;</span>, <span class="at">sheet=</span>x)}) </span>
<span id="cb275-6"><a href="数据导入导出与预处理.html#cb275-6" tabindex="-1"></a></span>
<span id="cb275-7"><a href="数据导入导出与预处理.html#cb275-7" tabindex="-1"></a><span class="co"># 给列表的元素命名</span></span>
<span id="cb275-8"><a href="数据导入导出与预处理.html#cb275-8" tabindex="-1"></a><span class="fu">names</span>(multi_df) <span class="ot">&lt;-</span> sheets </span>
<span id="cb275-9"><a href="数据导入导出与预处理.html#cb275-9" tabindex="-1"></a></span>
<span id="cb275-10"><a href="数据导入导出与预处理.html#cb275-10" tabindex="-1"></a><span class="co"># 查看生成的列表长度（每个元素对应一个工作表）</span></span>
<span id="cb275-11"><a href="数据导入导出与预处理.html#cb275-11" tabindex="-1"></a><span class="fu">length</span>(multi_df) </span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="数据导入导出与预处理.html#cb277-1" tabindex="-1"></a><span class="co"># 显示Year2020工作表前5行记录</span></span>
<span id="cb277-2"><a href="数据导入导出与预处理.html#cb277-2" tabindex="-1"></a><span class="fu">head</span>(multi_df<span class="sc">$</span>Year2020,<span class="dv">5</span>) </span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   country     continent amount
##   &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;
## 1 Afghanistan Asia          11
## 2 Albania     Europe        30
## 3 Algeria     Africa        49
## 4 Andorra     Europe        55
## 5 Bahrain     Asia          20</code></pre>
</div>
<div id="文件读取汇总" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> 文件读取汇总<a href="数据导入导出与预处理.html#文件读取汇总" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<thead>
<tr class="header">
<th align="left">文件类型</th>
<th align="left">调用包</th>
<th align="left">读取函数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CSV文件（*.csv）</td>
<td align="left">utils（R自带）</td>
<td align="left">read.csv()</td>
</tr>
<tr class="even">
<td align="left">TXT文件（*.txt）</td>
<td align="left">utils（R自带）</td>
<td align="left">read.csv()</td>
</tr>
<tr class="odd">
<td align="left">excel文件（*.xlsx或*.xls）</td>
<td align="left">readxl</td>
<td align="left">read_excel()</td>
</tr>
<tr class="even">
<td align="left">SAS文件（*.sas7bdat）</td>
<td align="left">haven</td>
<td align="left">read.sas()</td>
</tr>
<tr class="odd">
<td align="left">SPSS文件（*.sav）</td>
<td align="left">haven</td>
<td align="left">read.sav()</td>
</tr>
<tr class="even">
<td align="left">STATA文件（*.dta）</td>
<td align="left">haven</td>
<td align="left">read_dta()</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="数据导出" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> 数据导出<a href="数据导入导出与预处理.html#数据导出" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<colgroup>
<col width="25%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">数据导出类型</th>
<th align="left">导出时调用包</th>
<th align="left">导出函数</th>
<th align="left">读取时调用包</th>
<th align="left">读取函数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">R数据文件（*.Rdata）</td>
<td align="left">base（R自带）</td>
<td align="left">save()</td>
<td align="left">base（R自带）</td>
<td align="left">load()</td>
</tr>
<tr class="even">
<td align="left">CSV文件（*.csv）</td>
<td align="left">utils（R自带）</td>
<td align="left">write.csv()</td>
<td align="left">utils（R自带）</td>
<td align="left">read.csv()</td>
</tr>
<tr class="odd">
<td align="left">自定义文件（*.csv或*.txt）</td>
<td align="left">utils（R自带）</td>
<td align="left">write.table()</td>
<td align="left">utils（R自带）</td>
<td align="left">read.csv()</td>
</tr>
<tr class="even">
<td align="left">excel文件（*.xlsx）</td>
<td align="left">WriteXLS</td>
<td align="left">WriteXLS()</td>
<td align="left">readxl</td>
<td align="left">read_excel()</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="数据导入导出与预处理.html#cb279-1" tabindex="-1"></a><span class="co"># 将goods_df导出为goods.csv文件，导出位置为D盘</span></span>
<span id="cb279-2"><a href="数据导入导出与预处理.html#cb279-2" tabindex="-1"></a><span class="co"># row.names=FALSE时将不会导出数据索引值</span></span>
<span id="cb279-3"><a href="数据导入导出与预处理.html#cb279-3" tabindex="-1"></a><span class="co"># write.csv(goods_df, &quot;D:/goods.csv&quot;, row.names=FALSE) # 注意：此行代码在线上书中将不会执行</span></span></code></pre></div>
</div>
<div id="路径" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> 路径<a href="数据导入导出与预处理.html#路径" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>我们在读取文件时，可以使用文件完整的存储路径，比如<code>D:/a-quick-start-on-data-analysis-in-r/data/goods.xlsx</code>，它能帮助我们找到任意位置上的文件，这条路径被称<strong>绝对路径（absolute directory）</strong>。</p>
<p>有时，文件的绝对路径很长，而且我们需要处理的文件一般都集中在特定文件夹下，这时，为了避免代码冗长，我们可以先设定一个工作路径，告诉R在查找文件时只查找存储在这个工作路径下的文件。这样，当我们要调用特定文件时，只需要调用该文件在<u>当前工作路径</u>下的路径，这条路径被称为<strong>相对路径（relative directory）</strong>。例如，当我们将<code>D:/a-quick-start-on-data-analysis-in-r</code>设置为工作路径，这时，如果要调用<code>goods.xlsx</code>，只需要输入路径<code>data/goods.xlsx</code>即可。</p>
<p>我们可以使用<code>getwd()</code>函数来获取当前的工作路径，使用<code>setwd()</code>设置新的工作路径。</p>
<p><strong><em>注意</em></strong>：</p>
<li>
在设置了工作路径后，数据或图片的<strong>存储</strong>与<strong>读取</strong>都会默认在<u>该工作路径</u>下进行。
</li>
<li>
需要读取存储在其它路径的数据时，需要使用<strong>绝对路径</strong>。
</li>
</div>
<div id="数据预处理" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> 数据预处理<a href="数据导入导出与预处理.html#数据预处理" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="tidyverse包" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> tidyverse包<a href="数据导入导出与预处理.html#tidyverse包" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong><em>tidyverse</em></strong>包是R中的一个功能强大的数据处理包<a href="https://tidyverse.tidyverse.org/">大集合</a>，包含<strong><em>readr</em></strong>、<strong><em>haven</em></strong>和<strong><em>readxl</em></strong>（数据读取与导出），<strong><em>tidyr</em></strong>（数据清洗），<strong><em>dplyr</em></strong>（数据整理），<strong><em>stringr</em></strong>（字符处理），<strong><em>ggplot2</em></strong>（数据可视化）等。</p>
<p>利用<strong><em>tidyverse</em></strong>包可以通过管道符<code>%&gt;%</code>（快捷键<code>shift</code>+<code>ctrl</code>+<code>m</code>）对数据进行链式操作，从而对数据连续处理。</p>
<p><img src="img/chapter2-tidyverse-workflow.png" /></p>
</div>
<div id="批量读取数据" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> 批量读取数据<a href="数据导入导出与预处理.html#批量读取数据" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有时我们需要对特定文件夹下面的特定类型（或者特定名称）文件进行<strong>批量读取</strong>，这时可以通过<code>list.files()</code>+<code>map_dfr()</code>函数实现。</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="数据导入导出与预处理.html#cb280-1" tabindex="-1"></a><span class="co"># 加载包</span></span>
<span id="cb280-2"><a href="数据导入导出与预处理.html#cb280-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb280-3"><a href="数据导入导出与预处理.html#cb280-3" tabindex="-1"></a></span>
<span id="cb280-4"><a href="数据导入导出与预处理.html#cb280-4" tabindex="-1"></a><span class="co"># 获取data文件夹下的所有txt文件名</span></span>
<span id="cb280-5"><a href="数据导入导出与预处理.html#cb280-5" tabindex="-1"></a>txt_names <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path=</span><span class="st">&quot;data&quot;</span>, <span class="at">pattern=</span><span class="st">&quot;txt&quot;</span>, <span class="at">full.names=</span><span class="cn">TRUE</span>)</span>
<span id="cb280-6"><a href="数据导入导出与预处理.html#cb280-6" tabindex="-1"></a></span>
<span id="cb280-7"><a href="数据导入导出与预处理.html#cb280-7" tabindex="-1"></a><span class="co"># 批量读取txt文件并存储为一个数据框</span></span>
<span id="cb280-8"><a href="数据导入导出与预处理.html#cb280-8" tabindex="-1"></a><span class="co"># 调用tidyverse的map_dfr()函数，由于获取的txt文件使用;分隔符，所以用read_csv2()函数读取每个文件</span></span>
<span id="cb280-9"><a href="数据导入导出与预处理.html#cb280-9" tabindex="-1"></a>df_batch <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(txt_names, read_csv2) </span>
<span id="cb280-10"><a href="数据导入导出与预处理.html#cb280-10" tabindex="-1"></a></span>
<span id="cb280-11"><a href="数据导入导出与预处理.html#cb280-11" tabindex="-1"></a><span class="co"># 显示前5行记录</span></span>
<span id="cb280-12"><a href="数据导入导出与预处理.html#cb280-12" tabindex="-1"></a><span class="fu">head</span>(df_batch,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   company revenue other_income
##   &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt;
## 1 A          10.1         2.10
## 2 B          18.7         4.06
## 3 C          20.3         6.31
## 4 D          36.8         5.08
## 5 E          59.7         9.43</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="数据导入导出与预处理.html#cb282-1" tabindex="-1"></a><span class="co"># 显示后5行记录</span></span>
<span id="cb282-2"><a href="数据导入导出与预处理.html#cb282-2" tabindex="-1"></a><span class="fu">tail</span>(df_batch,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   company revenue other_income
##   &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt;
## 1 D          36.8         5.08
## 2 E          59.7         9.43
## 3 F          72.0        10.9 
## 4 G          68.8         6.03
## 5 H          66.4         7.92</code></pre>
<p><strong><em>注意</em></strong>：</p>
<li>
读取的数据是垂直堆叠（vertical stack）。
</li>
<li>
读取数据的变量名如果一致，则数据会放在同一列；如果不一致，则会另外创建列变量。
</li>
</div>
<div id="数据合并" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> 数据合并<a href="数据导入导出与预处理.html#数据合并" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有时我们有多个数据框，包含了不同的变量数据，在进行数据预处理与分析之前，需要使用<code>*_join()</code>函数将它们合并为一个数据框。</p>
<div align="center">
<p><img src="img/chapter2-join.png" width="80%" height="80%"/></p>
</div>
<p>数据的合并依照<strong>键（key）</strong>进行，合并方式：</p>
<li>
内连接（inner_join）：保留两个数据键相同的记录并进行合并。
</li>
<li>
左连接（left_join）：保留左侧数据（X）的所有记录，右侧数据（Y）的键跟左侧数据相同的，才进行合并，左侧数据缺失值标记为<code>NA</code>。
</li>
<li>
右连接（right_join）：保留右侧数据（Y）的所有记录，左侧数据（X）的键跟右侧数据相同的，才进行合并，右侧数据缺失值标记为<code>NA</code>。
</li>
<li>
全连接（full_join）：保留两个数据中的所有记录并进行合并，缺失值标记为<code>NA</code>。
</li>
<li>
半连接（semi_join）：保留左侧数据（X）中与右侧数据（Y）的键相同的记录。
</li>
<li>
反连接（anti_join）：保留左侧数据（X）中与右侧数据（Y）的键不同的记录。
</li>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="数据导入导出与预处理.html#cb284-1" tabindex="-1"></a><span class="co"># 设置随机种子</span></span>
<span id="cb284-2"><a href="数据导入导出与预处理.html#cb284-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb284-3"><a href="数据导入导出与预处理.html#cb284-3" tabindex="-1"></a></span>
<span id="cb284-4"><a href="数据导入导出与预处理.html#cb284-4" tabindex="-1"></a><span class="co"># 创建左侧数据框</span></span>
<span id="cb284-5"><a href="数据导入导出与预处理.html#cb284-5" tabindex="-1"></a>df_left <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb284-6"><a href="数据导入导出与预处理.html#cb284-6" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">seq</span>(<span class="dv">5</span>),</span>
<span id="cb284-7"><a href="数据导入导出与预处理.html#cb284-7" tabindex="-1"></a>  <span class="at">region =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;South&quot;</span>, <span class="st">&quot;North&quot;</span>), <span class="at">times=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>)),</span>
<span id="cb284-8"><a href="数据导入导出与预处理.html#cb284-8" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;F&quot;</span>,<span class="st">&quot;M&quot;</span>), <span class="at">times=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>)), </span>
<span id="cb284-9"><a href="数据导入导出与预处理.html#cb284-9" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb284-10"><a href="数据导入导出与预处理.html#cb284-10" tabindex="-1"></a>)</span>
<span id="cb284-11"><a href="数据导入导出与预处理.html#cb284-11" tabindex="-1"></a></span>
<span id="cb284-12"><a href="数据导入导出与预处理.html#cb284-12" tabindex="-1"></a><span class="co"># 创建右侧数据框</span></span>
<span id="cb284-13"><a href="数据导入导出与预处理.html#cb284-13" tabindex="-1"></a>df_right <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb284-14"><a href="数据导入导出与预处理.html#cb284-14" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">seq</span>(<span class="dv">3</span>,<span class="dv">7</span>),</span>
<span id="cb284-15"><a href="数据导入导出与预处理.html#cb284-15" tabindex="-1"></a>  <span class="at">region =</span> <span class="fu">rep</span>(<span class="st">&quot;South&quot;</span>, <span class="at">times=</span><span class="dv">5</span>),</span>
<span id="cb284-16"><a href="数据导入导出与预处理.html#cb284-16" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>), <span class="at">times=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>)), </span>
<span id="cb284-17"><a href="数据导入导出与预处理.html#cb284-17" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb284-18"><a href="数据导入导出与预处理.html#cb284-18" tabindex="-1"></a>)</span>
<span id="cb284-19"><a href="数据导入导出与预处理.html#cb284-19" tabindex="-1"></a></span>
<span id="cb284-20"><a href="数据导入导出与预处理.html#cb284-20" tabindex="-1"></a><span class="co"># 单键合并</span></span>
<span id="cb284-21"><a href="数据导入导出与预处理.html#cb284-21" tabindex="-1"></a>df_single_key_join <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(df_left, df_right, <span class="at">by=</span><span class="st">&quot;ID&quot;</span>)</span>
<span id="cb284-22"><a href="数据导入导出与预处理.html#cb284-22" tabindex="-1"></a><span class="co"># 默认左右侧变量分别加&quot;.x&quot;和&quot;.y&quot;标注</span></span>
<span id="cb284-23"><a href="数据导入导出与预处理.html#cb284-23" tabindex="-1"></a>df_single_key_join </span></code></pre></div>
<pre><code>##   ID region.x gender    value.x region.y sex    value.y
## 1  3    South      F -0.8356286    South   M -0.8204684
## 2  4    North      M  1.5952808    South   M  0.4874291
## 3  5    North      M  0.3295078    South   M  0.7383247</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="数据导入导出与预处理.html#cb286-1" tabindex="-1"></a><span class="co"># 多键合并</span></span>
<span id="cb286-2"><a href="数据导入导出与预处理.html#cb286-2" tabindex="-1"></a>df_multi_key_join <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(df_left, df_right, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;region&quot;</span>))</span>
<span id="cb286-3"><a href="数据导入导出与预处理.html#cb286-3" tabindex="-1"></a>df_multi_key_join</span></code></pre></div>
<pre><code>##   ID region gender    value.x sex    value.y
## 1  3  South      F -0.8356286   M -0.8204684</code></pre>
<p>当目标数据框的键名相同时，可以使用上述合并函数。当目标数据框的键名不同时，可以使用<code>merge()</code>函数并声明<code>by.x</code>和<code>by.y</code>参数达到数据合并的效果。</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="数据导入导出与预处理.html#cb288-1" tabindex="-1"></a><span class="co"># 不同键名的多键合并</span></span>
<span id="cb288-2"><a href="数据导入导出与预处理.html#cb288-2" tabindex="-1"></a>df_diff_key_join <span class="ot">&lt;-</span> <span class="fu">merge</span>(df_left, df_right, <span class="at">by.x=</span><span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;gender&quot;</span>), <span class="at">by.y=</span><span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;sex&quot;</span>))</span>
<span id="cb288-3"><a href="数据导入导出与预处理.html#cb288-3" tabindex="-1"></a>df_diff_key_join</span></code></pre></div>
<pre><code>##   ID gender region.x   value.x region.y   value.y
## 1  4      M    North 1.5952808    South 0.4874291
## 2  5      M    North 0.3295078    South 0.7383247</code></pre>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="数据导入导出与预处理.html#cb290-1" tabindex="-1"></a><span class="co"># 内连接</span></span>
<span id="cb290-2"><a href="数据导入导出与预处理.html#cb290-2" tabindex="-1"></a>df_inner_join <span class="ot">&lt;-</span> <span class="fu">merge</span>(df_left, df_right, <span class="at">by=</span><span class="st">&quot;ID&quot;</span>)</span>
<span id="cb290-3"><a href="数据导入导出与预处理.html#cb290-3" tabindex="-1"></a>df_inner_join</span></code></pre></div>
<pre><code>##   ID region.x gender    value.x region.y sex    value.y
## 1  3    South      F -0.8356286    South   M -0.8204684
## 2  4    North      M  1.5952808    South   M  0.4874291
## 3  5    North      M  0.3295078    South   M  0.7383247</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="数据导入导出与预处理.html#cb292-1" tabindex="-1"></a><span class="co"># 左连接</span></span>
<span id="cb292-2"><a href="数据导入导出与预处理.html#cb292-2" tabindex="-1"></a>df_left_join <span class="ot">&lt;-</span> <span class="fu">merge</span>(df_left, df_right, <span class="at">by=</span><span class="st">&quot;ID&quot;</span>, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb292-3"><a href="数据导入导出与预处理.html#cb292-3" tabindex="-1"></a>df_left_join</span></code></pre></div>
<pre><code>##   ID region.x gender    value.x region.y  sex    value.y
## 1  1    South      F -0.6264538     &lt;NA&gt; &lt;NA&gt;         NA
## 2  2    South      F  0.1836433     &lt;NA&gt; &lt;NA&gt;         NA
## 3  3    South      F -0.8356286    South    M -0.8204684
## 4  4    North      M  1.5952808    South    M  0.4874291
## 5  5    North      M  0.3295078    South    M  0.7383247</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="数据导入导出与预处理.html#cb294-1" tabindex="-1"></a><span class="co"># 右连接</span></span>
<span id="cb294-2"><a href="数据导入导出与预处理.html#cb294-2" tabindex="-1"></a>df_right_join <span class="ot">&lt;-</span> <span class="fu">merge</span>(df_left, df_right, <span class="at">by=</span><span class="st">&quot;ID&quot;</span>, <span class="at">all.y=</span><span class="cn">TRUE</span>)</span>
<span id="cb294-3"><a href="数据导入导出与预处理.html#cb294-3" tabindex="-1"></a>df_right_join</span></code></pre></div>
<pre><code>##   ID region.x gender    value.x region.y sex    value.y
## 1  3    South      F -0.8356286    South   M -0.8204684
## 2  4    North      M  1.5952808    South   M  0.4874291
## 3  5    North      M  0.3295078    South   M  0.7383247
## 4  6     &lt;NA&gt;   &lt;NA&gt;         NA    South   F  0.5757814
## 5  7     &lt;NA&gt;   &lt;NA&gt;         NA    South   F -0.3053884</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="数据导入导出与预处理.html#cb296-1" tabindex="-1"></a><span class="co"># 全连接</span></span>
<span id="cb296-2"><a href="数据导入导出与预处理.html#cb296-2" tabindex="-1"></a>df_full_join <span class="ot">&lt;-</span> <span class="fu">merge</span>(df_left, df_right, <span class="at">by=</span><span class="st">&quot;ID&quot;</span>, <span class="at">all=</span><span class="cn">TRUE</span>)</span>
<span id="cb296-3"><a href="数据导入导出与预处理.html#cb296-3" tabindex="-1"></a>df_full_join</span></code></pre></div>
<pre><code>##   ID region.x gender    value.x region.y  sex    value.y
## 1  1    South      F -0.6264538     &lt;NA&gt; &lt;NA&gt;         NA
## 2  2    South      F  0.1836433     &lt;NA&gt; &lt;NA&gt;         NA
## 3  3    South      F -0.8356286    South    M -0.8204684
## 4  4    North      M  1.5952808    South    M  0.4874291
## 5  5    North      M  0.3295078    South    M  0.7383247
## 6  6     &lt;NA&gt;   &lt;NA&gt;         NA    South    F  0.5757814
## 7  7     &lt;NA&gt;   &lt;NA&gt;         NA    South    F -0.3053884</code></pre>
<p>当有多个数据框需要合并时，可以先将数据框放入一个列表中，再使用<code>reduce()</code>函数合并。</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="数据导入导出与预处理.html#cb298-1" tabindex="-1"></a><span class="co"># 将数据框放入列表中</span></span>
<span id="cb298-2"><a href="数据导入导出与预处理.html#cb298-2" tabindex="-1"></a>df_list <span class="ot">&lt;-</span> <span class="fu">list</span>(df_diff_key_join, df_inner_join, df_left_join, df_right_join)</span>
<span id="cb298-3"><a href="数据导入导出与预处理.html#cb298-3" tabindex="-1"></a></span>
<span id="cb298-4"><a href="数据导入导出与预处理.html#cb298-4" tabindex="-1"></a><span class="co"># 多数据框合并</span></span>
<span id="cb298-5"><a href="数据导入导出与预处理.html#cb298-5" tabindex="-1"></a>df_list_join <span class="ot">&lt;-</span> df_list <span class="sc">%&gt;%</span> <span class="fu">reduce</span>(inner_join, <span class="at">by=</span><span class="st">&quot;ID&quot;</span>)</span>
<span id="cb298-6"><a href="数据导入导出与预处理.html#cb298-6" tabindex="-1"></a>df_list_join</span></code></pre></div>
<pre><code>##   ID gender.x region.x.x value.x.x region.y.x value.y.x region.x.y gender.y value.x.y
## 1  4        M      North 1.5952808      South 0.4874291      North        M 1.5952808
## 2  5        M      North 0.3295078      South 0.7383247      North        M 0.3295078
##   region.y.y sex.x value.y.y region.x.x.x gender.x.x value.x.x.x region.y.x.x sex.y
## 1      South     M 0.4874291        North          M   1.5952808        South     M
## 2      South     M 0.7383247        North          M   0.3295078        South     M
##   value.y.x.x region.x.y.y gender.y.y value.x.y.y region.y.y.y sex value.y.y.y
## 1   0.4874291        North          M   1.5952808        South   M   0.4874291
## 2   0.7383247        North          M   0.3295078        South   M   0.7383247</code></pre>
</div>
<div id="数据清洗" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> 数据清洗<a href="数据导入导出与预处理.html#数据清洗" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>数据清洗是数据预处理的第一步，包括变量选择，变量重命名，缺失值处理，重复值删除等。</p>
<div id="变量选择" class="section level4 hasAnchor" number="2.4.4.1">
<h4><span class="header-section-number">2.4.4.1</span> 变量选择<a href="数据导入导出与预处理.html#变量选择" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>变量的选择可以使用<code>select()</code>函数，<code>()</code>内直接填写变量名称或者变量的索引值。详细介绍参考<a href="https://dplyr.tidyverse.org/reference/select.html">此链接</a>。</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="数据导入导出与预处理.html#cb300-1" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb300-2"><a href="数据导入导出与预处理.html#cb300-2" tabindex="-1"></a>df_darwin <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/darwin.csv&quot;</span>)</span>
<span id="cb300-3"><a href="数据导入导出与预处理.html#cb300-3" tabindex="-1"></a></span>
<span id="cb300-4"><a href="数据导入导出与预处理.html#cb300-4" tabindex="-1"></a><span class="co"># 选取 air_time1 和 gender 变量</span></span>
<span id="cb300-5"><a href="数据导入导出与预处理.html#cb300-5" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> <span class="fu">select</span>(air_time1, gender) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   air_time1 gender
##       &lt;dbl&gt; &lt;chr&gt; 
## 1      5160 M     
## 2     51980 M     
## 3      2600 M     
## 4      2130 F     
## 5      2310 F     
## 6      1920 F</code></pre>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="数据导入导出与预处理.html#cb302-1" tabindex="-1"></a><span class="co"># 选取除 air_time1 和 gender 之外的所有变量</span></span>
<span id="cb302-2"><a href="数据导入导出与预处理.html#cb302-2" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(air_time1, gender)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##   ID    gmrt_in_air1 max_x_extension1 max_y_extension1 mean_acc_in_air1 mean_gmrt1
##   &lt;chr&gt;        &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;
## 1 id_1          121.              957             6601            0.362      104. 
## 2 id_2          115.             1694             6998            0.273       99.4
## 3 id_3          230.             2333             5802            0.387      201. 
## 4 id_4          369.             1756             8159            0.557      276. 
## 5 id_5          258.              987             4732            0.266      185. 
## 6 id_6          200.             1548             6260            0.213      155. 
## # ℹ 26 more variables: air_time2 &lt;dbl&gt;, gmrt_in_air2 &lt;dbl&gt;, max_x_extension2 &lt;dbl&gt;,
## #   max_y_extension2 &lt;dbl&gt;, mean_acc_in_air2 &lt;dbl&gt;, mean_gmrt2 &lt;dbl&gt;, air_time3 &lt;dbl&gt;,
## #   gmrt_in_air3 &lt;dbl&gt;, max_x_extension3 &lt;dbl&gt;, max_y_extension3 &lt;dbl&gt;,
## #   mean_acc_in_air3 &lt;dbl&gt;, mean_gmrt3 &lt;dbl&gt;, air_time4 &lt;dbl&gt;, gmrt_in_air4 &lt;dbl&gt;,
## #   max_x_extension4 &lt;dbl&gt;, max_y_extension4 &lt;dbl&gt;, mean_acc_in_air4 &lt;dbl&gt;,
## #   mean_gmrt4 &lt;dbl&gt;, air_time5 &lt;dbl&gt;, gmrt_in_air5 &lt;dbl&gt;, max_x_extension5 &lt;dbl&gt;,
## #   max_y_extension5 &lt;dbl&gt;, mean_acc_in_air5 &lt;dbl&gt;, mean_gmrt5 &lt;dbl&gt;, class &lt;chr&gt;, …</code></pre>
<p>使用<code>starts_with()</code>选取以特定字符开头的变量。</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="数据导入导出与预处理.html#cb304-1" tabindex="-1"></a><span class="co"># 选取以 air 或 max 开头的变量</span></span>
<span id="cb304-2"><a href="数据导入导出与预处理.html#cb304-2" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;air&quot;</span>, <span class="st">&quot;max&quot;</span>))) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 15
##   air_time1 air_time2 air_time3 air_time4 air_time5 max_x_extension1 max_y_extension1
##       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1      5160      6085      4345     30625     66034              957             6601
## 2     51980     10515     15885      7975     12875             1694             6998
## 3      2600       560       420      1030       680             2333             5802
## 4      2130     13735      3795     13625     10735             1756             8159
## 5      2310      4225      2255    100650      1050              987             4732
## 6      1920      8115      2620      3065      2400             1548             6260
## # ℹ 8 more variables: max_x_extension2 &lt;dbl&gt;, max_y_extension2 &lt;dbl&gt;,
## #   max_x_extension3 &lt;dbl&gt;, max_y_extension3 &lt;dbl&gt;, max_x_extension4 &lt;dbl&gt;,
## #   max_y_extension4 &lt;dbl&gt;, max_x_extension5 &lt;dbl&gt;, max_y_extension5 &lt;dbl&gt;</code></pre>
<p>使用<code>match()</code>选取符合特定正则表达式的变量。</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="数据导入导出与预处理.html#cb306-1" tabindex="-1"></a><span class="co"># 选取名称中包含 extension4 和 extension5 的变量</span></span>
<span id="cb306-2"><a href="数据导入导出与预处理.html#cb306-2" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;extension[45]&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   max_x_extension4 max_y_extension4 max_x_extension5 max_y_extension5
##              &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1             4353             4292            10933             3651
## 2             7718             8055             5667             5503
## 3             3960             4013             2556             2245
## 4             4487             4475             2535             2426
## 5             4429             4196             2394             1194
## 6             4184             4379             2486             2447</code></pre>
<p>使用<code>num_range()</code>选取以特定范围的数字结尾的变量。注意，数字的前缀必须为完整的变量名。</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="数据导入导出与预处理.html#cb308-1" tabindex="-1"></a><span class="co"># 选取名称中 max_x_extension3、max_x_extension4 和 max_x_extension5 的变量</span></span>
<span id="cb308-2"><a href="数据导入导出与预处理.html#cb308-2" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">num_range</span>(<span class="st">&quot;max_x_extension&quot;</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   max_x_extension3 max_x_extension4 max_x_extension5
##              &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1             4495             4353            10933
## 2             4498             7718             5667
## 3             4645             3960             2556
## 4             4568             4487             2535
## 5             4076             4429             2394
## 6             4075             4184             2486</code></pre>
</div>
<div id="变量重命名" class="section level4 hasAnchor" number="2.4.4.2">
<h4><span class="header-section-number">2.4.4.2</span> 变量重命名<a href="数据导入导出与预处理.html#变量重命名" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>变量的重命名可以使用<code>rename()</code>函数，<code>()</code>内填写<code>新名称=旧名称</code>。</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="数据导入导出与预处理.html#cb310-1" tabindex="-1"></a><span class="co"># 将 gender 重命名为 sex</span></span>
<span id="cb310-2"><a href="数据导入导出与预处理.html#cb310-2" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> <span class="fu">select</span>(air_time1, gender) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sex=</span>gender) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   air_time1 sex  
##       &lt;dbl&gt; &lt;chr&gt;
## 1      5160 M    
## 2     51980 M    
## 3      2600 M    
## 4      2130 F    
## 5      2310 F    
## 6      1920 F</code></pre>
</div>
<div id="缺失值处理" class="section level4 hasAnchor" number="2.4.4.3">
<h4><span class="header-section-number">2.4.4.3</span> 缺失值处理<a href="数据导入导出与预处理.html#缺失值处理" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>在进行缺失值处理前，我们需要了解各个变量的缺失值情况。</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="数据导入导出与预处理.html#cb312-1" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb312-2"><a href="数据导入导出与预处理.html#cb312-2" tabindex="-1"></a>df_miss <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/darwin-missing.csv&quot;</span>) </span>
<span id="cb312-3"><a href="数据导入导出与预处理.html#cb312-3" tabindex="-1"></a></span>
<span id="cb312-4"><a href="数据导入导出与预处理.html#cb312-4" tabindex="-1"></a><span class="co"># 获取各变量的缺失数</span></span>
<span id="cb312-5"><a href="数据导入导出与预处理.html#cb312-5" tabindex="-1"></a><span class="fu">apply</span>(df_miss, <span class="dv">2</span>, <span class="cf">function</span>(x) {<span class="fu">sum</span>(<span class="fu">is.na</span>(x))}) </span></code></pre></div>
<pre><code>##               ID        air_time1     gmrt_in_air1 max_x_extension1           gender 
##                0                2                1                4                2</code></pre>
<p>通常而言，对于缺失比例<strong>大于20%</strong>的变量，我们倾向于将该变量剔除。</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="数据导入导出与预处理.html#cb314-1" tabindex="-1"></a><span class="co"># 获取各变量的缺失数</span></span>
<span id="cb314-2"><a href="数据导入导出与预处理.html#cb314-2" tabindex="-1"></a>col_miss_count <span class="ot">&lt;-</span> <span class="fu">apply</span>(df_miss, <span class="dv">2</span>, <span class="cf">function</span>(x) {<span class="fu">sum</span>(<span class="fu">is.na</span>(x))}) </span>
<span id="cb314-3"><a href="数据导入导出与预处理.html#cb314-3" tabindex="-1"></a></span>
<span id="cb314-4"><a href="数据导入导出与预处理.html#cb314-4" tabindex="-1"></a><span class="co"># 保留缺失占比不超过20%的变量</span></span>
<span id="cb314-5"><a href="数据导入导出与预处理.html#cb314-5" tabindex="-1"></a>df_miss_col <span class="ot">&lt;-</span> df_miss[, col_miss_count<span class="sc">/</span><span class="fu">nrow</span>(df_miss) <span class="sc">&lt;=</span> <span class="fl">0.2</span>] </span></code></pre></div>
<p>对于有缺失值的记录，我们可以<u>删除</u>或者进行<u>缺失值填补</u>。</p>
<p>仅对所有变量均缺失的记录进行删除。</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="数据导入导出与预处理.html#cb315-1" tabindex="-1"></a><span class="co"># 除去第一个ID变量，其余变量都有缺失的记录将被删除</span></span>
<span id="cb315-2"><a href="数据导入导出与预处理.html#cb315-2" tabindex="-1"></a>df_miss_col <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">if_any</span>(<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(df_miss_col)), <span class="sc">~!</span><span class="fu">is.na</span>(.)))</span></code></pre></div>
<pre><code>## # A tibble: 9 × 4
##   ID    air_time1 gmrt_in_air1 gender
##   &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt; 
## 1 id_1       5160         121. M     
## 2 id_3       2600         230. M     
## 3 id_4       2130         369. F     
## 4 id_5         NA         258. F     
## 5 id_6       1920         200. F     
## 6 id_7       6415         277. F     
## 7 id_8       1510         284. F     
## 8 id_9       4860         237. M     
## 9 id_10      6265         382. &lt;NA&gt;</code></pre>
<p>对任意变量有缺失的记录进行删除。</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="数据导入导出与预处理.html#cb317-1" tabindex="-1"></a><span class="co"># 除去第一个ID变量，任意变量中有缺失的记录将被删除</span></span>
<span id="cb317-2"><a href="数据导入导出与预处理.html#cb317-2" tabindex="-1"></a>df_miss_col <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">if_all</span>(<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(df_miss_col)), <span class="sc">~!</span><span class="fu">is.na</span>(.x)))</span></code></pre></div>
<pre><code>## # A tibble: 7 × 4
##   ID    air_time1 gmrt_in_air1 gender
##   &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt; 
## 1 id_1       5160         121. M     
## 2 id_3       2600         230. M     
## 3 id_4       2130         369. F     
## 4 id_6       1920         200. F     
## 5 id_7       6415         277. F     
## 6 id_8       1510         284. F     
## 7 id_9       4860         237. M</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="数据导入导出与预处理.html#cb319-1" tabindex="-1"></a><span class="co"># 任意变量中有缺失的记录将被删除</span></span>
<span id="cb319-2"><a href="数据导入导出与预处理.html#cb319-2" tabindex="-1"></a>df_miss_col <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span></code></pre></div>
<pre><code>## # A tibble: 7 × 4
##   ID    air_time1 gmrt_in_air1 gender
##   &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt; 
## 1 id_1       5160         121. M     
## 2 id_3       2600         230. M     
## 3 id_4       2130         369. F     
## 4 id_6       1920         200. F     
## 5 id_7       6415         277. F     
## 6 id_8       1510         284. F     
## 7 id_9       4860         237. M</code></pre>
<p>对特定变量有缺失的记录进行删除。</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="数据导入导出与预处理.html#cb321-1" tabindex="-1"></a><span class="co"># gender变量中有缺失的记录将被删除</span></span>
<span id="cb321-2"><a href="数据导入导出与预处理.html#cb321-2" tabindex="-1"></a>df_miss_col <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gender))</span></code></pre></div>
<pre><code>## # A tibble: 8 × 4
##   ID    air_time1 gmrt_in_air1 gender
##   &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt; 
## 1 id_1       5160         121. M     
## 2 id_3       2600         230. M     
## 3 id_4       2130         369. F     
## 4 id_5         NA         258. F     
## 5 id_6       1920         200. F     
## 6 id_7       6415         277. F     
## 7 id_8       1510         284. F     
## 8 id_9       4860         237. M</code></pre>
<p>使用<strong>均值</strong>填补缺失值。</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="数据导入导出与预处理.html#cb323-1" tabindex="-1"></a><span class="co"># 获取均值以便比较</span></span>
<span id="cb323-2"><a href="数据导入导出与预处理.html#cb323-2" tabindex="-1"></a><span class="fu">mean</span>(df_miss_col<span class="sc">$</span>air_time1, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co"># 3857.5</span></span></code></pre></div>
<pre><code>## [1] 3857.5</code></pre>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="数据导入导出与预处理.html#cb325-1" tabindex="-1"></a><span class="fu">mean</span>(df_miss_col<span class="sc">$</span>gmrt_in_air1, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co"># 261.9154</span></span></code></pre></div>
<pre><code>## [1] 261.9154</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="数据导入导出与预处理.html#cb327-1" tabindex="-1"></a><span class="co"># 对连续型变量进行填补</span></span>
<span id="cb327-2"><a href="数据导入导出与预处理.html#cb327-2" tabindex="-1"></a>df_miss_col <span class="sc">%&gt;%</span> <span class="fu">mutate_if</span>(is.double, <span class="sc">~</span><span class="fu">replace_na</span>(.x, <span class="fu">mean</span>(.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 4
##    ID    air_time1 gmrt_in_air1 gender
##    &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt; 
##  1 id_1      5160          121. M     
##  2 id_2      3858.         262. &lt;NA&gt;  
##  3 id_3      2600          230. M     
##  4 id_4      2130          369. F     
##  5 id_5      3858.         258. F     
##  6 id_6      1920          200. F     
##  7 id_7      6415          277. F     
##  8 id_8      1510          284. F     
##  9 id_9      4860          237. M     
## 10 id_10     6265          382. &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="数据导入导出与预处理.html#cb329-1" tabindex="-1"></a><span class="co"># 第二种写法，将`~`替换成function(){}形式</span></span>
<span id="cb329-2"><a href="数据导入导出与预处理.html#cb329-2" tabindex="-1"></a>df_miss_col <span class="sc">%&gt;%</span> <span class="fu">mutate_if</span>(is.double, <span class="cf">function</span>(x){<span class="fu">replace_na</span>(x, <span class="fu">mean</span>(x, <span class="at">na.rm=</span><span class="cn">TRUE</span>))})</span></code></pre></div>
<pre><code>## # A tibble: 10 × 4
##    ID    air_time1 gmrt_in_air1 gender
##    &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt; 
##  1 id_1      5160          121. M     
##  2 id_2      3858.         262. &lt;NA&gt;  
##  3 id_3      2600          230. M     
##  4 id_4      2130          369. F     
##  5 id_5      3858.         258. F     
##  6 id_6      1920          200. F     
##  7 id_7      6415          277. F     
##  8 id_8      1510          284. F     
##  9 id_9      4860          237. M     
## 10 id_10     6265          382. &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="数据导入导出与预处理.html#cb331-1" tabindex="-1"></a><span class="co"># 第三种写法，直接列举变量名</span></span>
<span id="cb331-2"><a href="数据导入导出与预处理.html#cb331-2" tabindex="-1"></a>df_miss_col <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&quot;air_time1&quot;</span>,<span class="st">&quot;gmrt_in_air1&quot;</span>), <span class="cf">function</span>(x) {<span class="fu">replace</span>(x, <span class="fu">is.na</span>(x), <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))})</span></code></pre></div>
<pre><code>## # A tibble: 10 × 4
##    ID    air_time1 gmrt_in_air1 gender
##    &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt; 
##  1 id_1      5160          121. M     
##  2 id_2      3858.         262. &lt;NA&gt;  
##  3 id_3      2600          230. M     
##  4 id_4      2130          369. F     
##  5 id_5      3858.         258. F     
##  6 id_6      1920          200. F     
##  7 id_7      6415          277. F     
##  8 id_8      1510          284. F     
##  9 id_9      4860          237. M     
## 10 id_10     6265          382. &lt;NA&gt;</code></pre>
<p>使用<strong>中位数</strong>填补缺失值。</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="数据导入导出与预处理.html#cb333-1" tabindex="-1"></a><span class="co"># 获取中位数以便比较</span></span>
<span id="cb333-2"><a href="数据导入导出与预处理.html#cb333-2" tabindex="-1"></a><span class="fu">median</span>(df_miss_col<span class="sc">$</span>air_time1, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co"># 3730</span></span></code></pre></div>
<pre><code>## [1] 3730</code></pre>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="数据导入导出与预处理.html#cb335-1" tabindex="-1"></a><span class="fu">median</span>(df_miss_col<span class="sc">$</span>gmrt_in_air1, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co"># 257.9971</span></span></code></pre></div>
<pre><code>## [1] 257.9971</code></pre>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="数据导入导出与预处理.html#cb337-1" tabindex="-1"></a><span class="co"># 对连续型变量进行填补</span></span>
<span id="cb337-2"><a href="数据导入导出与预处理.html#cb337-2" tabindex="-1"></a>df_miss_col <span class="sc">%&gt;%</span> <span class="fu">mutate_if</span>(is.double, <span class="sc">~</span><span class="fu">replace_na</span>(.x, <span class="fu">median</span>(.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 4
##    ID    air_time1 gmrt_in_air1 gender
##    &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt; 
##  1 id_1       5160         121. M     
##  2 id_2       3730         258. &lt;NA&gt;  
##  3 id_3       2600         230. M     
##  4 id_4       2130         369. F     
##  5 id_5       3730         258. F     
##  6 id_6       1920         200. F     
##  7 id_7       6415         277. F     
##  8 id_8       1510         284. F     
##  9 id_9       4860         237. M     
## 10 id_10      6265         382. &lt;NA&gt;</code></pre>
<p>使用<strong>众数</strong>填补缺失值。</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="数据导入导出与预处理.html#cb339-1" tabindex="-1"></a><span class="co"># 构建众数函数</span></span>
<span id="cb339-2"><a href="数据导入导出与预处理.html#cb339-2" tabindex="-1"></a>mode <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb339-3"><a href="数据导入导出与预处理.html#cb339-3" tabindex="-1"></a>  ux <span class="ot">&lt;-</span> <span class="fu">unique</span>(x) <span class="co"># 获取无重复元素的向量</span></span>
<span id="cb339-4"><a href="数据导入导出与预处理.html#cb339-4" tabindex="-1"></a>  ux[<span class="fu">which.max</span>(<span class="fu">tabulate</span>(<span class="fu">match</span>(x, ux)))] <span class="co"># 获取众数</span></span>
<span id="cb339-5"><a href="数据导入导出与预处理.html#cb339-5" tabindex="-1"></a>}</span>
<span id="cb339-6"><a href="数据导入导出与预处理.html#cb339-6" tabindex="-1"></a></span>
<span id="cb339-7"><a href="数据导入导出与预处理.html#cb339-7" tabindex="-1"></a><span class="co"># 对字符型变量进行填补</span></span>
<span id="cb339-8"><a href="数据导入导出与预处理.html#cb339-8" tabindex="-1"></a>df_miss_col <span class="sc">%&gt;%</span> <span class="fu">mutate_if</span>(is.character, <span class="sc">~</span><span class="fu">replace_na</span>(.x, <span class="fu">mode</span>(.x)))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 4
##    ID    air_time1 gmrt_in_air1 gender
##    &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt; 
##  1 id_1       5160         121. M     
##  2 id_2         NA          NA  F     
##  3 id_3       2600         230. M     
##  4 id_4       2130         369. F     
##  5 id_5         NA         258. F     
##  6 id_6       1920         200. F     
##  7 id_7       6415         277. F     
##  8 id_8       1510         284. F     
##  9 id_9       4860         237. M     
## 10 id_10      6265         382. F</code></pre>
<p>使用<strong><em>mice</em></strong>包对缺失值进行<strong>多重插补（multiple imputation）</strong>。</p>
<p>多重插补法假设缺失值是<u>随机发生</u>的，使用<u>链式方程</u>对缺失值进行填补，<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8499698/">具体步骤</a>为：</p>
<ol style="list-style-type: decimal">
<li>从变量的实际观测值中随机取值对对应变量的缺失值进行填补。</li>
<li>移除第一个缺失变量中有缺失值的记录，以第一个缺失变量为因变量，其余变量为自变量构建回归方程，通过随机回归插补法（即在构建的回归方程中添加扰动项<code>norm()</code>）填补第一个缺失变量的缺失值。</li>
<li>以类似的方法对剩余缺失变量的缺失值进行填补。</li>
<li>步骤2和3完成1次为1个循环（iteration）。通常重复5-20个循环构建一组填补后的数据。</li>
<li>重复步骤4直至获得 m 组填补后的数据。<font color="red"><em>缺失值填补部分到此结束</em></font></li>
<li>对 m 组数据分别进行统计分析，返回统计分析的平均结果。<font color="red"><em>此步骤为后续统计分析过程</em></font></li>
</ol>
<p>具体操作可参考<a href="https://zhuanlan.zhihu.com/p/36436260">这篇文章</a>。</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="数据导入导出与预处理.html#cb341-1" tabindex="-1"></a><span class="co"># 加载包</span></span>
<span id="cb341-2"><a href="数据导入导出与预处理.html#cb341-2" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb341-3"><a href="数据导入导出与预处理.html#cb341-3" tabindex="-1"></a></span>
<span id="cb341-4"><a href="数据导入导出与预处理.html#cb341-4" tabindex="-1"></a><span class="co"># 数据处理</span></span>
<span id="cb341-5"><a href="数据导入导出与预处理.html#cb341-5" tabindex="-1"></a>df_miss_col <span class="ot">&lt;-</span> df_miss_col <span class="sc">%&gt;%</span></span>
<span id="cb341-6"><a href="数据导入导出与预处理.html#cb341-6" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gender)) <span class="sc">%&gt;%</span> <span class="co"># gender变量中有缺失的记录将被删除</span></span>
<span id="cb341-7"><a href="数据导入导出与预处理.html#cb341-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender=</span><span class="fu">as_factor</span>(gender)) <span class="co"># 将gender变量类型从字符型转换为分类变量</span></span>
<span id="cb341-8"><a href="数据导入导出与预处理.html#cb341-8" tabindex="-1"></a></span>
<span id="cb341-9"><a href="数据导入导出与预处理.html#cb341-9" tabindex="-1"></a><span class="co"># 使用&quot;pmm&quot;法插补缺失值</span></span>
<span id="cb341-10"><a href="数据导入导出与预处理.html#cb341-10" tabindex="-1"></a>impute_mice <span class="ot">&lt;-</span> <span class="fu">mice</span>(df_miss_col, <span class="at">method=</span><span class="st">&quot;pmm&quot;</span>, <span class="at">printFlag=</span><span class="cn">FALSE</span>, <span class="at">seed=</span><span class="dv">1</span>)</span>
<span id="cb341-11"><a href="数据导入导出与预处理.html#cb341-11" tabindex="-1"></a></span>
<span id="cb341-12"><a href="数据导入导出与预处理.html#cb341-12" tabindex="-1"></a><span class="co"># 使用插补后的数据进行逻辑回归</span></span>
<span id="cb341-13"><a href="数据导入导出与预处理.html#cb341-13" tabindex="-1"></a>fit_mice <span class="ot">&lt;-</span> <span class="fu">with</span>(impute_mice, <span class="fu">glm</span>(gender<span class="sc">~</span>air_time1<span class="sc">+</span>gmrt_in_air1, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">&#39;logit&#39;</span>)))</span>
<span id="cb341-14"><a href="数据导入导出与预处理.html#cb341-14" tabindex="-1"></a></span>
<span id="cb341-15"><a href="数据导入导出与预处理.html#cb341-15" tabindex="-1"></a><span class="co"># 汇总逻辑回归结果</span></span>
<span id="cb341-16"><a href="数据导入导出与预处理.html#cb341-16" tabindex="-1"></a>pooled_mice <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit_mice)</span>
<span id="cb341-17"><a href="数据导入导出与预处理.html#cb341-17" tabindex="-1"></a></span>
<span id="cb341-18"><a href="数据导入导出与预处理.html#cb341-18" tabindex="-1"></a><span class="co"># 报告最终结果</span></span>
<span id="cb341-19"><a href="数据导入导出与预处理.html#cb341-19" tabindex="-1"></a><span class="fu">summary</span>(pooled_mice)</span></code></pre></div>
<pre><code>##           term      estimate    std.error  statistic       df   p.value
## 1  (Intercept) -8.2204661643 9.0793281103 -0.9054047 3.730475 0.4198889
## 2    air_time1 -0.0003599382 0.0007634819 -0.4714430 3.443569 0.6656127
## 3 gmrt_in_air1  0.0422655603 0.0452813630  0.9333986 3.687814 0.4075974</code></pre>
<p>使用<strong><em>missForest</em></strong>包对缺失值进行填补。</p>
<p><strong><em>missForest</em></strong>包先将缺失值用均值或众数进行填补，然后通过<u>随机森林</u>方法对填补值进行修正。与MICE不同，该方法是一种<strong>非参数</strong>填补法，当变量间的关系为<strong>非线性</strong>或者存在<strong>交互作用</strong>时，也有较好的填补效果。同时，该方法可以应用于混合数据类型（比如同时存在连续变量和分量变量缺失的情况）且在噪声数据（noisy data）下也有良好表现。缺点是样本量不能太少，对算力要求较高，耗时较长。具体介绍可参考<a href="https://rpubs.com/lmorgan95/MissForest">这篇文章</a>。</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="数据导入导出与预处理.html#cb343-1" tabindex="-1"></a><span class="co"># 加载包</span></span>
<span id="cb343-2"><a href="数据导入导出与预处理.html#cb343-2" tabindex="-1"></a><span class="fu">library</span>(missForest)</span>
<span id="cb343-3"><a href="数据导入导出与预处理.html#cb343-3" tabindex="-1"></a></span>
<span id="cb343-4"><a href="数据导入导出与预处理.html#cb343-4" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb343-5"><a href="数据导入导出与预处理.html#cb343-5" tabindex="-1"></a>df_miss <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/darwin-missing.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 10 Columns: 5
## ── Column specification ───────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): ID, gender
## dbl (3): air_time1, gmrt_in_air1, max_x_extension1
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="数据导入导出与预处理.html#cb345-1" tabindex="-1"></a><span class="co"># 保留缺失占比不超过20%的变量</span></span>
<span id="cb345-2"><a href="数据导入导出与预处理.html#cb345-2" tabindex="-1"></a>df_miss_col <span class="ot">&lt;-</span> df_miss[, col_miss_count<span class="sc">/</span><span class="fu">nrow</span>(df_miss) <span class="sc">&lt;=</span> <span class="fl">0.2</span>]</span>
<span id="cb345-3"><a href="数据导入导出与预处理.html#cb345-3" tabindex="-1"></a></span>
<span id="cb345-4"><a href="数据导入导出与预处理.html#cb345-4" tabindex="-1"></a><span class="co"># 填补除第一列变量以外的所有变量</span></span>
<span id="cb345-5"><a href="数据导入导出与预处理.html#cb345-5" tabindex="-1"></a><span class="co"># impute_mf &lt;- missForest(df_miss_col[,-1]) # 直接运行此代码会报错</span></span></code></pre></div>
<p><strong><em>注意</em></strong>：如果直接运行最后一行代码会报错。</p>
<div align="left">
<p><img src="img/chapter2-missForest-error.png" width="80%" height="80%"/></p>
</div>
<p>通过<code>class()</code>函数查看数据类型，可以发现，<code>df_miss_col</code>数据框的类型为：</p>
<div align="left">
<p><img src="img/chapter2-missForest-error-2.png" width="80%" height="80%"/></p>
</div>
<p>“tbl_df”和”tbl”是<strong><em>tidyverse</em></strong>的<strong><em>dplyr</em></strong>包默认的数据框处理和存储类型，它能更简洁地呈现数据并能更高效地对数据框进行处理与运算（详细介绍见<a href="https://tibble.tidyverse.org/">此链接</a>）。但是<strong><em>missForest</em></strong>处理对象为”data.frame”类型，因此需要进行数据框类型的转换。</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="数据导入导出与预处理.html#cb346-1" tabindex="-1"></a><span class="co"># 加载包</span></span>
<span id="cb346-2"><a href="数据导入导出与预处理.html#cb346-2" tabindex="-1"></a><span class="fu">library</span>(missForest)</span>
<span id="cb346-3"><a href="数据导入导出与预处理.html#cb346-3" tabindex="-1"></a></span>
<span id="cb346-4"><a href="数据导入导出与预处理.html#cb346-4" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb346-5"><a href="数据导入导出与预处理.html#cb346-5" tabindex="-1"></a>df_miss <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/darwin-missing.csv&quot;</span>)</span>
<span id="cb346-6"><a href="数据导入导出与预处理.html#cb346-6" tabindex="-1"></a></span>
<span id="cb346-7"><a href="数据导入导出与预处理.html#cb346-7" tabindex="-1"></a><span class="co"># 保留缺失占比不超过20%的变量</span></span>
<span id="cb346-8"><a href="数据导入导出与预处理.html#cb346-8" tabindex="-1"></a>df_miss_col <span class="ot">&lt;-</span> df_miss[, col_miss_count<span class="sc">/</span><span class="fu">nrow</span>(df_miss) <span class="sc">&lt;=</span> <span class="fl">0.2</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb346-9"><a href="数据导入导出与预处理.html#cb346-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender=</span><span class="fu">as.factor</span>(gender)) <span class="sc">%&gt;%</span> <span class="co"># 将字符型变量转变为分类变量，才能进行填补</span></span>
<span id="cb346-10"><a href="数据导入导出与预处理.html#cb346-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="co"># 将数据框转为&quot;data.frame&quot;类型</span></span>
<span id="cb346-11"><a href="数据导入导出与预处理.html#cb346-11" tabindex="-1"></a></span>
<span id="cb346-12"><a href="数据导入导出与预处理.html#cb346-12" tabindex="-1"></a><span class="co"># 填补除第一列变量以外的所有变量</span></span>
<span id="cb346-13"><a href="数据导入导出与预处理.html#cb346-13" tabindex="-1"></a>impute_mf <span class="ot">&lt;-</span> <span class="fu">missForest</span>(df_miss_col[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb346-14"><a href="数据导入导出与预处理.html#cb346-14" tabindex="-1"></a></span>
<span id="cb346-15"><a href="数据导入导出与预处理.html#cb346-15" tabindex="-1"></a><span class="co"># 查看填补后的数据</span></span>
<span id="cb346-16"><a href="数据导入导出与预处理.html#cb346-16" tabindex="-1"></a>impute_mf<span class="sc">$</span>ximp</span></code></pre></div>
<pre><code>##    air_time1 gmrt_in_air1 gender
## 1   5160.000     120.8042      M
## 2   4111.035     277.6232      F
## 3   2600.000     229.9340      M
## 4   2130.000     369.4033      F
## 5   4336.855     257.9971      F
## 6   1920.000     199.7650      F
## 7   6415.000     276.5146      F
## 8   1510.000     284.0157      F
## 9   4860.000     236.8763      M
## 10  6265.000     381.9289      F</code></pre>
<p>有时，我们需要对一些缺失值进行上下填补，这时可以使用<code>fill()</code><a href="https://tidyr.tidyverse.org/reference/fill.html">函数</a>。</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="数据导入导出与预处理.html#cb348-1" tabindex="-1"></a><span class="co"># 创建数据框</span></span>
<span id="cb348-2"><a href="数据导入导出与预处理.html#cb348-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb348-3"><a href="数据导入导出与预处理.html#cb348-3" tabindex="-1"></a>sales <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb348-4"><a href="数据导入导出与预处理.html#cb348-4" tabindex="-1"></a>  <span class="at">quarter=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Q1&quot;</span>,<span class="st">&quot;Q2&quot;</span>,<span class="st">&quot;Q3&quot;</span>,<span class="st">&quot;Q4&quot;</span>), <span class="at">times=</span><span class="dv">3</span>)),</span>
<span id="cb348-5"><a href="数据导入导出与预处理.html#cb348-5" tabindex="-1"></a>  <span class="at">year=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="st">&quot;2001&quot;</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="st">&quot;2002&quot;</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="st">&quot;2003&quot;</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>),</span>
<span id="cb348-6"><a href="数据导入导出与预处理.html#cb348-6" tabindex="-1"></a>  <span class="at">values=</span><span class="fu">floor</span>(<span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">12</span>, <span class="at">mean=</span><span class="dv">100</span>, <span class="at">sd=</span><span class="dv">12</span>))</span>
<span id="cb348-7"><a href="数据导入导出与预处理.html#cb348-7" tabindex="-1"></a>)</span>
<span id="cb348-8"><a href="数据导入导出与预处理.html#cb348-8" tabindex="-1"></a></span>
<span id="cb348-9"><a href="数据导入导出与预处理.html#cb348-9" tabindex="-1"></a><span class="co"># 查看数据框</span></span>
<span id="cb348-10"><a href="数据导入导出与预处理.html#cb348-10" tabindex="-1"></a>sales</span></code></pre></div>
<pre><code>##    quarter year values
## 1       Q1 &lt;NA&gt;     92
## 2       Q2 2001    102
## 3       Q3 &lt;NA&gt;     89
## 4       Q4 &lt;NA&gt;    119
## 5       Q1 2002    103
## 6       Q2 &lt;NA&gt;     90
## 7       Q3 &lt;NA&gt;    105
## 8       Q4 &lt;NA&gt;    108
## 9       Q1 2003    106
## 10      Q2 &lt;NA&gt;     96
## 11      Q3 &lt;NA&gt;    118
## 12      Q4 &lt;NA&gt;    104</code></pre>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="数据导入导出与预处理.html#cb350-1" tabindex="-1"></a><span class="co"># 对year填补</span></span>
<span id="cb350-2"><a href="数据导入导出与预处理.html#cb350-2" tabindex="-1"></a>sales <span class="sc">%&gt;%</span> <span class="fu">fill</span>(year, <span class="at">.direction=</span><span class="st">&quot;downup&quot;</span>) <span class="co"># 先向下填补，向下填补完后再向上填补</span></span></code></pre></div>
<pre><code>##    quarter year values
## 1       Q1 2001     92
## 2       Q2 2001    102
## 3       Q3 2001     89
## 4       Q4 2001    119
## 5       Q1 2002    103
## 6       Q2 2002     90
## 7       Q3 2002    105
## 8       Q4 2002    108
## 9       Q1 2003    106
## 10      Q2 2003     96
## 11      Q3 2003    118
## 12      Q4 2003    104</code></pre>
</div>
</div>
<div id="数据整理" class="section level3 hasAnchor" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> 数据整理<a href="数据导入导出与预处理.html#数据整理" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="变量的拆分与合并" class="section level4 hasAnchor" number="2.4.5.1">
<h4><span class="header-section-number">2.4.5.1</span> 变量的拆分与合并<a href="数据导入导出与预处理.html#变量的拆分与合并" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>有些变量中包含的内容会以分隔符（如<code>,</code>、<code>-</code>、<code>|</code>、<code>/</code>等）的形式记录，而我们需要将这些记录拆分时，就需要用到<code>separate_wider_*()</code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">函数</a>。</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="数据导入导出与预处理.html#cb352-1" tabindex="-1"></a><span class="co"># 将 region 变量拆分为 state 和 city</span></span>
<span id="cb352-2"><a href="数据导入导出与预处理.html#cb352-2" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> </span>
<span id="cb352-3"><a href="数据导入导出与预处理.html#cb352-3" tabindex="-1"></a>  <span class="fu">select</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb352-4"><a href="数据导入导出与预处理.html#cb352-4" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(region, <span class="at">delim=</span><span class="st">&quot;,&quot;</span>, <span class="at">names=</span><span class="fu">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;city&quot;</span>), <span class="at">cols_remove=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb352-5"><a href="数据导入导出与预处理.html#cb352-5" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   state city        region        
##   &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;         
## 1 TX    San Antonio TX,San Antonio
## 2 TX    San Antonio TX,San Antonio
## 3 TX    Austin      TX,Austin     
## 4 TX    Houston     TX,Houston    
## 5 TX    Dallas      TX,Dallas     
## 6 Ohio  Columbus    Ohio,Columbus</code></pre>
<p>有时我们需要将变量中的记录拆分成列，就需要用到<code>separate_longer_*()</code><a href="https://tidyr.tidyverse.org/reference/separate_longer_delim.html">函数</a>。</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="数据导入导出与预处理.html#cb354-1" tabindex="-1"></a><span class="co"># 将region以&quot;,&quot;为分隔，拆分成行</span></span>
<span id="cb354-2"><a href="数据导入导出与预处理.html#cb354-2" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> </span>
<span id="cb354-3"><a href="数据导入导出与预处理.html#cb354-3" tabindex="-1"></a>  <span class="fu">select</span>(ID, air_time1, region) <span class="sc">%&gt;%</span> </span>
<span id="cb354-4"><a href="数据导入导出与预处理.html#cb354-4" tabindex="-1"></a>  <span class="fu">separate_longer_delim</span>(region, <span class="at">delim=</span><span class="st">&quot;,&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># 其余变量的值将被复制到新创建的行中</span></span>
<span id="cb354-5"><a href="数据导入导出与预处理.html#cb354-5" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   ID    air_time1 region     
##   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;      
## 1 id_1       5160 TX         
## 2 id_1       5160 San Antonio
## 3 id_2      51980 TX         
## 4 id_2      51980 San Antonio
## 5 id_3       2600 TX         
## 6 id_3       2600 Austin</code></pre>
<p>使用<code>unite()</code>函数将多列按照特定分隔符合并为一列。</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="数据导入导出与预处理.html#cb356-1" tabindex="-1"></a><span class="co"># 将region, gender, class变量合并为一列(new_var)，以-连接</span></span>
<span id="cb356-2"><a href="数据导入导出与预处理.html#cb356-2" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> </span>
<span id="cb356-3"><a href="数据导入导出与预处理.html#cb356-3" tabindex="-1"></a>  <span class="fu">select</span>(region, gender, class) <span class="sc">%&gt;%</span> </span>
<span id="cb356-4"><a href="数据导入导出与预处理.html#cb356-4" tabindex="-1"></a>  <span class="fu">unite</span>(new_var, region<span class="sc">:</span>class, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb356-5"><a href="数据导入导出与预处理.html#cb356-5" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   new_var           
##   &lt;chr&gt;             
## 1 TX,San Antonio-M-P
## 2 TX,San Antonio-M-P
## 3 TX,Austin-M-P     
## 4 TX,Houston-F-P    
## 5 TX,Dallas-F-P     
## 6 Ohio,Columbus-F-P</code></pre>
</div>
<div id="数据框的长宽转换" class="section level4 hasAnchor" number="2.4.5.2">
<h4><span class="header-section-number">2.4.5.2</span> 数据框的长宽转换<a href="数据导入导出与预处理.html#数据框的长宽转换" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>不同的数据分析方法需要不同的数据框输入格式，比如线性回归需要各个变量依次罗列，即宽数据格式（wide format），混合效应模型需要将不同时间点放在同一个变量下面，即长数据格式（long format），这就需要使用<code>pivot_*()</code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">函数</a>。</p>
<div align="center">
<img src="img/chapter2-long-wide.png" width=80% height=80%>
</div>
<p>将宽数据格式转为长数据格式</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="数据导入导出与预处理.html#cb358-1" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb358-2"><a href="数据导入导出与预处理.html#cb358-2" tabindex="-1"></a>df_darwin <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/darwin.csv&quot;</span>)</span>
<span id="cb358-3"><a href="数据导入导出与预处理.html#cb358-3" tabindex="-1"></a></span>
<span id="cb358-4"><a href="数据导入导出与预处理.html#cb358-4" tabindex="-1"></a><span class="co"># 单变量转换</span></span>
<span id="cb358-5"><a href="数据导入导出与预处理.html#cb358-5" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> </span>
<span id="cb358-6"><a href="数据导入导出与预处理.html#cb358-6" tabindex="-1"></a>  <span class="fu">select</span>(ID, <span class="fu">num_range</span>(<span class="st">&quot;air_time&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)) <span class="sc">%&gt;%</span> <span class="co"># 提取 air_time 1-5的变量 </span></span>
<span id="cb358-7"><a href="数据导入导出与预处理.html#cb358-7" tabindex="-1"></a>  <span class="fu">pivot_longer</span>( <span class="co"># 转为长数据格式</span></span>
<span id="cb358-8"><a href="数据导入导出与预处理.html#cb358-8" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;air_time&quot;</span>), <span class="co"># 选择目标变量</span></span>
<span id="cb358-9"><a href="数据导入导出与预处理.html#cb358-9" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;air_time&quot;</span>, <span class="co"># 存储目标变量名称的新变量名称</span></span>
<span id="cb358-10"><a href="数据导入导出与预处理.html#cb358-10" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">&quot;air_time&quot;</span>, <span class="co"># 识别目标变量的前缀，前缀之后的部分将转为新变量的元素</span></span>
<span id="cb358-11"><a href="数据导入导出与预处理.html#cb358-11" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span> <span class="co"># 存储目标变量原先数据的新变量名称</span></span>
<span id="cb358-12"><a href="数据导入导出与预处理.html#cb358-12" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 870 × 3
##    ID    air_time value
##    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;
##  1 id_1  1         5160
##  2 id_1  2         6085
##  3 id_1  3         4345
##  4 id_1  4        30625
##  5 id_1  5        66034
##  6 id_2  1        51980
##  7 id_2  2        10515
##  8 id_2  3        15885
##  9 id_2  4         7975
## 10 id_2  5        12875
## # ℹ 860 more rows</code></pre>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="数据导入导出与预处理.html#cb360-1" tabindex="-1"></a><span class="co"># 多变量转换</span></span>
<span id="cb360-2"><a href="数据导入导出与预处理.html#cb360-2" tabindex="-1"></a>df_darwin <span class="sc">%&gt;%</span> </span>
<span id="cb360-3"><a href="数据导入导出与预处理.html#cb360-3" tabindex="-1"></a>  <span class="fu">select</span>(ID, <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;air_time&quot;</span>,<span class="st">&quot;gmrt_in_air&quot;</span>))) <span class="sc">%&gt;%</span> <span class="co"># 提取 air_time 和 gmrt_in_air 1-5的变量</span></span>
<span id="cb360-4"><a href="数据导入导出与预处理.html#cb360-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>( <span class="co"># 转为长数据格式</span></span>
<span id="cb360-5"><a href="数据导入导出与预处理.html#cb360-5" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">!</span>ID, <span class="co"># 提取除 ID 之外的所有变量</span></span>
<span id="cb360-6"><a href="数据导入导出与预处理.html#cb360-6" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;item&quot;</span>, <span class="st">&quot;wave&quot;</span>), <span class="co"># 构建存储目标变量和目标变量后缀的新变量名称</span></span>
<span id="cb360-7"><a href="数据导入导出与预处理.html#cb360-7" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">&quot;([</span><span class="sc">\\</span><span class="st">w_]+)(</span><span class="sc">\\</span><span class="st">d)&quot;</span>, <span class="co"># 定义识别目标变量中想要提取元素（即括号内的元素）的正则表达式</span></span>
<span id="cb360-8"><a href="数据导入导出与预处理.html#cb360-8" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span> <span class="co"># 存储目标变量原先数据的新变量名称</span></span>
<span id="cb360-9"><a href="数据导入导出与预处理.html#cb360-9" tabindex="-1"></a>  ) </span></code></pre></div>
<pre><code>## # A tibble: 1,740 × 4
##    ID    item        wave   value
##    &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
##  1 id_1  air_time    1      5160 
##  2 id_1  air_time    2      6085 
##  3 id_1  air_time    3      4345 
##  4 id_1  air_time    4     30625 
##  5 id_1  air_time    5     66034 
##  6 id_1  gmrt_in_air 1       121.
##  7 id_1  gmrt_in_air 2       269.
##  8 id_1  gmrt_in_air 3       330.
##  9 id_1  gmrt_in_air 4       233.
## 10 id_1  gmrt_in_air 5       126.
## # ℹ 1,730 more rows</code></pre>
<p>将长数据格式转为宽数据格式</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="数据导入导出与预处理.html#cb362-1" tabindex="-1"></a><span class="co"># 创建数据框</span></span>
<span id="cb362-2"><a href="数据导入导出与预处理.html#cb362-2" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb362-3"><a href="数据导入导出与预处理.html#cb362-3" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">each=</span><span class="dv">4</span>),</span>
<span id="cb362-4"><a href="数据导入导出与预处理.html#cb362-4" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Q1&quot;</span>,<span class="st">&quot;Q2&quot;</span>,<span class="st">&quot;Q3&quot;</span>,<span class="st">&quot;Q4&quot;</span>), <span class="at">times=</span><span class="dv">2</span>),</span>
<span id="cb362-5"><a href="数据导入导出与预处理.html#cb362-5" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2001</span>,<span class="dv">2002</span>), <span class="at">each=</span><span class="dv">4</span>),</span>
<span id="cb362-6"><a href="数据导入导出与预处理.html#cb362-6" tabindex="-1"></a>  <span class="at">value =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb362-7"><a href="数据导入导出与预处理.html#cb362-7" tabindex="-1"></a>)</span>
<span id="cb362-8"><a href="数据导入导出与预处理.html#cb362-8" tabindex="-1"></a></span>
<span id="cb362-9"><a href="数据导入导出与预处理.html#cb362-9" tabindex="-1"></a>df_long <span class="sc">%&gt;%</span> </span>
<span id="cb362-10"><a href="数据导入导出与预处理.html#cb362-10" tabindex="-1"></a>  <span class="fu">pivot_wider</span>( <span class="co"># 转为宽数据格式</span></span>
<span id="cb362-11"><a href="数据导入导出与预处理.html#cb362-11" tabindex="-1"></a>    <span class="at">names_from =</span> quarter, <span class="co"># 依据目标变量将新生成的变量名称</span></span>
<span id="cb362-12"><a href="数据导入导出与预处理.html#cb362-12" tabindex="-1"></a>    <span class="at">values_from =</span> value <span class="co"># 目标变量的数值</span></span>
<span id="cb362-13"><a href="数据导入导出与预处理.html#cb362-13" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##      ID  year    Q1    Q2    Q3    Q4
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     1  2001     5     6     7     8
## 2     2  2002     9    10    11    12</code></pre>
</div>
</div>
<div id="删除重复记录" class="section level3 hasAnchor" number="2.4.6">
<h3><span class="header-section-number">2.4.6</span> 删除重复记录<a href="数据导入导出与预处理.html#删除重复记录" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>当数据中出现重复记录的情况时，可以使用<code>unique()</code>和<code>duplicated()</code>函数删除重复记录。</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="数据导入导出与预处理.html#cb364-1" tabindex="-1"></a>df_duplicate <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb364-2"><a href="数据导入导出与预处理.html#cb364-2" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb364-3"><a href="数据导入导出与预处理.html#cb364-3" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb364-4"><a href="数据导入导出与预处理.html#cb364-4" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">20</span>,<span class="dv">10</span>,<span class="dv">20</span>)</span>
<span id="cb364-5"><a href="数据导入导出与预处理.html#cb364-5" tabindex="-1"></a>)</span>
<span id="cb364-6"><a href="数据导入导出与预处理.html#cb364-6" tabindex="-1"></a></span>
<span id="cb364-7"><a href="数据导入导出与预处理.html#cb364-7" tabindex="-1"></a><span class="co"># 剔除所有变量均重复的记录，仅保留第一条重复记录</span></span>
<span id="cb364-8"><a href="数据导入导出与预处理.html#cb364-8" tabindex="-1"></a>df_duplicate <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code></pre></div>
<pre><code>##   ID group value
## 1  1     1    20
## 3  2     1    10
## 4  3     2    20</code></pre>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="数据导入导出与预处理.html#cb366-1" tabindex="-1"></a><span class="co"># 剔除特定变量有重复的记录，仅保留第一条重复记录</span></span>
<span id="cb366-2"><a href="数据导入导出与预处理.html#cb366-2" tabindex="-1"></a>df_duplicate[<span class="sc">!</span><span class="fu">duplicated</span>(df_duplicate<span class="sc">$</span>value),]</span></code></pre></div>
<pre><code>##   ID group value
## 1  1     1    20
## 3  2     1    10</code></pre>
</div>
<div id="按条件筛选记录" class="section level3 hasAnchor" number="2.4.7">
<h3><span class="header-section-number">2.4.7</span> 按条件筛选记录<a href="数据导入导出与预处理.html#按条件筛选记录" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>采用<code>filter()</code>函数可以根据变量内容筛选记录。</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="数据导入导出与预处理.html#cb368-1" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb368-2"><a href="数据导入导出与预处理.html#cb368-2" tabindex="-1"></a>df_goods <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;data/goods.xlsx&quot;</span>)</span>
<span id="cb368-3"><a href="数据导入导出与预处理.html#cb368-3" tabindex="-1"></a></span>
<span id="cb368-4"><a href="数据导入导出与预处理.html#cb368-4" tabindex="-1"></a><span class="co"># 筛选amount&gt;=50，continent=&quot;Europe&quot;的记录</span></span>
<span id="cb368-5"><a href="数据导入导出与预处理.html#cb368-5" tabindex="-1"></a>df_goods <span class="sc">%&gt;%</span> </span>
<span id="cb368-6"><a href="数据导入导出与预处理.html#cb368-6" tabindex="-1"></a>  <span class="fu">filter</span>(amount<span class="sc">&gt;=</span><span class="dv">50</span> <span class="sc">&amp;</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span>) </span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   country continent amount
##   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt;
## 1 Andorra Europe        55
## 2 Belarus Europe        82</code></pre>
</div>
<div id="按条件创建变量" class="section level3 hasAnchor" number="2.4.8">
<h3><span class="header-section-number">2.4.8</span> 按条件创建变量<a href="数据导入导出与预处理.html#按条件创建变量" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有时我们需要基于特定变量的值创建新的变量，这可以通过<code>mutate()</code>函数结合<code>if_else()</code>或<code>case_when()</code><a href="https://dplyr.tidyverse.org/reference/if_else.html">函数</a>实现。</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="数据导入导出与预处理.html#cb370-1" tabindex="-1"></a><span class="co"># 创建数据框</span></span>
<span id="cb370-2"><a href="数据导入导出与预处理.html#cb370-2" tabindex="-1"></a>df_bmi <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb370-3"><a href="数据导入导出与预处理.html#cb370-3" tabindex="-1"></a>  <span class="at">bmi =</span> <span class="fu">c</span>(<span class="fl">28.5</span>, <span class="fl">26.3</span>, <span class="cn">NA</span>, <span class="dv">23</span>, <span class="cn">NA</span>, <span class="dv">17</span>, <span class="fl">22.5</span>)</span>
<span id="cb370-4"><a href="数据导入导出与预处理.html#cb370-4" tabindex="-1"></a>)</span>
<span id="cb370-5"><a href="数据导入导出与预处理.html#cb370-5" tabindex="-1"></a></span>
<span id="cb370-6"><a href="数据导入导出与预处理.html#cb370-6" tabindex="-1"></a><span class="co"># 基于bmi数值创建新变量，将bmi划分为体重过低、体重正常、超重和肥胖4个等级</span></span>
<span id="cb370-7"><a href="数据导入导出与预处理.html#cb370-7" tabindex="-1"></a><span class="co"># 使用 if_else() 函数</span></span>
<span id="cb370-8"><a href="数据导入导出与预处理.html#cb370-8" tabindex="-1"></a>df_bmi <span class="sc">%&gt;%</span> </span>
<span id="cb370-9"><a href="数据导入导出与预处理.html#cb370-9" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># 使用mutate()函数创建新变量</span></span>
<span id="cb370-10"><a href="数据导入导出与预处理.html#cb370-10" tabindex="-1"></a>    <span class="at">bmi_class =</span> <span class="fu">if_else</span>(</span>
<span id="cb370-11"><a href="数据导入导出与预处理.html#cb370-11" tabindex="-1"></a>      bmi <span class="sc">&lt;</span> <span class="fl">18.5</span>,</span>
<span id="cb370-12"><a href="数据导入导出与预处理.html#cb370-12" tabindex="-1"></a>      <span class="st">&quot;体重过低&quot;</span>,</span>
<span id="cb370-13"><a href="数据导入导出与预处理.html#cb370-13" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb370-14"><a href="数据导入导出与预处理.html#cb370-14" tabindex="-1"></a>        bmi <span class="sc">&lt;</span> <span class="dv">24</span>,</span>
<span id="cb370-15"><a href="数据导入导出与预处理.html#cb370-15" tabindex="-1"></a>        <span class="st">&quot;体重正常&quot;</span>,</span>
<span id="cb370-16"><a href="数据导入导出与预处理.html#cb370-16" tabindex="-1"></a>        <span class="fu">if_else</span>(</span>
<span id="cb370-17"><a href="数据导入导出与预处理.html#cb370-17" tabindex="-1"></a>          bmi <span class="sc">&lt;</span> <span class="dv">28</span>,</span>
<span id="cb370-18"><a href="数据导入导出与预处理.html#cb370-18" tabindex="-1"></a>          <span class="st">&quot;超重&quot;</span>,</span>
<span id="cb370-19"><a href="数据导入导出与预处理.html#cb370-19" tabindex="-1"></a>          <span class="st">&quot;肥胖&quot;</span></span>
<span id="cb370-20"><a href="数据导入导出与预处理.html#cb370-20" tabindex="-1"></a>        )</span>
<span id="cb370-21"><a href="数据导入导出与预处理.html#cb370-21" tabindex="-1"></a>      )</span>
<span id="cb370-22"><a href="数据导入导出与预处理.html#cb370-22" tabindex="-1"></a>    )</span>
<span id="cb370-23"><a href="数据导入导出与预处理.html#cb370-23" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>##    bmi bmi_class
## 1 28.5      肥胖
## 2 26.3      超重
## 3   NA      &lt;NA&gt;
## 4 23.0  体重正常
## 5   NA      &lt;NA&gt;
## 6 17.0  体重过低
## 7 22.5  体重正常</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="数据导入导出与预处理.html#cb372-1" tabindex="-1"></a><span class="co"># 使用case_when()函数</span></span>
<span id="cb372-2"><a href="数据导入导出与预处理.html#cb372-2" tabindex="-1"></a>df_bmi <span class="sc">%&gt;%</span> </span>
<span id="cb372-3"><a href="数据导入导出与预处理.html#cb372-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb372-4"><a href="数据导入导出与预处理.html#cb372-4" tabindex="-1"></a>    <span class="at">bmi_class =</span> <span class="fu">case_when</span>(</span>
<span id="cb372-5"><a href="数据导入导出与预处理.html#cb372-5" tabindex="-1"></a>      bmi<span class="sc">&lt;</span><span class="fl">18.5</span> <span class="sc">~</span> <span class="st">&quot;体重过低&quot;</span>,</span>
<span id="cb372-6"><a href="数据导入导出与预处理.html#cb372-6" tabindex="-1"></a>      bmi<span class="sc">&lt;</span><span class="dv">24</span> <span class="sc">~</span> <span class="st">&quot;体重正常&quot;</span>,</span>
<span id="cb372-7"><a href="数据导入导出与预处理.html#cb372-7" tabindex="-1"></a>      bmi<span class="sc">&lt;</span><span class="dv">28</span> <span class="sc">~</span> <span class="st">&quot;超重&quot;</span>,</span>
<span id="cb372-8"><a href="数据导入导出与预处理.html#cb372-8" tabindex="-1"></a>      bmi<span class="sc">&gt;=</span><span class="dv">28</span> <span class="sc">~</span> <span class="st">&quot;肥胖&quot;</span>,</span>
<span id="cb372-9"><a href="数据导入导出与预处理.html#cb372-9" tabindex="-1"></a>      <span class="co"># TRUE ~ &quot;肥胖&quot; # 如果最后一个条件不做区分，完全用TRUE表示，则NA也会转为&quot;肥胖&quot;</span></span>
<span id="cb372-10"><a href="数据导入导出与预处理.html#cb372-10" tabindex="-1"></a>    )</span>
<span id="cb372-11"><a href="数据导入导出与预处理.html#cb372-11" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>##    bmi bmi_class
## 1 28.5      肥胖
## 2 26.3      超重
## 3   NA      &lt;NA&gt;
## 4 23.0  体重正常
## 5   NA      &lt;NA&gt;
## 6 17.0  体重过低
## 7 22.5  体重正常</code></pre>
</div>
<div id="chapter2-label-summarise" class="section level3 hasAnchor" number="2.4.9">
<h3><span class="header-section-number">2.4.9</span> 汇总函数summarise()与reframe()<a href="数据导入导出与预处理.html#chapter2-label-summarise" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>summarise()</code>汇总<a href="https://dplyr.tidyverse.org/reference/summarise.html">函数</a>，顾名思义，就是将数据进行汇总整理。如无特殊说明，则按变量返回一行汇总数据。如果与<code>group_by()</code>分组函数结合，则按照分组返回汇总数据。常用汇总计算的函数包括：</p>
<li>
<code>mean()</code>汇总均值。
</li>
<li>
<code>median()</code>汇总中位数。
</li>
<li>
<code>sd()</code>汇总标准差。
</li>
<li>
<code>IQR()</code>汇总四分位距。
</li>
<li>
<code>min()</code>汇总最小值。
</li>
<li>
<code>max()</code>汇总最大值。
</li>
<li>
<code>n()</code>总数。
</li>
<li>
<code>n_distinct()</code>非重复数。
</li>
<strong><em>注意</em></strong>：
<li>
上述现成函数在使用时需要写成<code>~FUN(.x)</code>（如<code>~mean(.x)</code>）的形式。
</li>
<li>
如果是自定义函数，可以直接写成<code>function(x){}</code>的形式。
</li>
<li>
如果想同时使用多个函数，可以用<code>list()</code>函数将目标函数合并。
</li>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="数据导入导出与预处理.html#cb374-1" tabindex="-1"></a><span class="co"># 导入数据</span></span>
<span id="cb374-2"><a href="数据导入导出与预处理.html#cb374-2" tabindex="-1"></a>darwin_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/darwin.csv&quot;</span>)</span>
<span id="cb374-3"><a href="数据导入导出与预处理.html#cb374-3" tabindex="-1"></a></span>
<span id="cb374-4"><a href="数据导入导出与预处理.html#cb374-4" tabindex="-1"></a>darwin_df <span class="sc">%&gt;%</span> </span>
<span id="cb374-5"><a href="数据导入导出与预处理.html#cb374-5" tabindex="-1"></a>  <span class="fu">select</span>(gender,air_time1, gmrt_in_air1) <span class="sc">%&gt;%</span> <span class="co"># 选择变量</span></span>
<span id="cb374-6"><a href="数据导入导出与预处理.html#cb374-6" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb374-7"><a href="数据导入导出与预处理.html#cb374-7" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(), <span class="co"># 计数</span></span>
<span id="cb374-8"><a href="数据导入导出与预处理.html#cb374-8" tabindex="-1"></a>    <span class="at">air_time1_avg =</span> <span class="fu">mean</span>(air_time1), <span class="co"># 获取 air_time1 均值</span></span>
<span id="cb374-9"><a href="数据导入导出与预处理.html#cb374-9" tabindex="-1"></a>    <span class="at">gmrt_in_air1_median =</span> <span class="fu">median</span>(gmrt_in_air1) <span class="co"># 获取 gmrt_in_air1 中位数</span></span>
<span id="cb374-10"><a href="数据导入导出与预处理.html#cb374-10" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   count air_time1_avg gmrt_in_air1_median
##   &lt;int&gt;         &lt;dbl&gt;               &lt;dbl&gt;
## 1   174         5664.                256.</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="数据导入导出与预处理.html#cb376-1" tabindex="-1"></a>darwin_df <span class="sc">%&gt;%</span> </span>
<span id="cb376-2"><a href="数据导入导出与预处理.html#cb376-2" tabindex="-1"></a>  <span class="fu">select</span>(gender,air_time1, gmrt_in_air1) <span class="sc">%&gt;%</span> <span class="co"># 选择变量</span></span>
<span id="cb376-3"><a href="数据导入导出与预处理.html#cb376-3" tabindex="-1"></a>  <span class="fu">group_by</span>(gender) <span class="sc">%&gt;%</span> <span class="co"># 按照 gender 分组</span></span>
<span id="cb376-4"><a href="数据导入导出与预处理.html#cb376-4" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb376-5"><a href="数据导入导出与预处理.html#cb376-5" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(), <span class="co"># 计数</span></span>
<span id="cb376-6"><a href="数据导入导出与预处理.html#cb376-6" tabindex="-1"></a>    <span class="at">air_time1_avg =</span> <span class="fu">mean</span>(air_time1), <span class="co"># 获取 air_time1 均值</span></span>
<span id="cb376-7"><a href="数据导入导出与预处理.html#cb376-7" tabindex="-1"></a>    <span class="at">gmrt_in_air1_median =</span> <span class="fu">median</span>(gmrt_in_air1) <span class="co"># 获取 gmrt_in_air1 中位数</span></span>
<span id="cb376-8"><a href="数据导入导出与预处理.html#cb376-8" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   gender count air_time1_avg gmrt_in_air1_median
##   &lt;chr&gt;  &lt;int&gt;         &lt;dbl&gt;               &lt;dbl&gt;
## 1 F         86         5452.                256.
## 2 M         88         5872.                258.</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="数据导入导出与预处理.html#cb378-1" tabindex="-1"></a><span class="co"># 依据特定条件批量汇总</span></span>
<span id="cb378-2"><a href="数据导入导出与预处理.html#cb378-2" tabindex="-1"></a>darwin_df <span class="sc">%&gt;%</span> </span>
<span id="cb378-3"><a href="数据导入导出与预处理.html#cb378-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb378-4"><a href="数据导入导出与预处理.html#cb378-4" tabindex="-1"></a>  <span class="fu">summarise_if</span>(</span>
<span id="cb378-5"><a href="数据导入导出与预处理.html#cb378-5" tabindex="-1"></a>    is.numeric, <span class="co"># 选择数字型变量</span></span>
<span id="cb378-6"><a href="数据导入导出与预处理.html#cb378-6" tabindex="-1"></a>    <span class="fu">list</span>(<span class="sc">~</span><span class="fu">mean</span>(.x), <span class="sc">~</span><span class="fu">median</span>(.x)) <span class="co"># 分别计算各变量的均值与中位数</span></span>
<span id="cb378-7"><a href="数据导入导出与预处理.html#cb378-7" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 12
##   air_time1_mean gmrt_in_air1_mean max_x_extension1_mean max_y_extension1_mean
##            &lt;dbl&gt;             &lt;dbl&gt;                 &lt;dbl&gt;                 &lt;dbl&gt;
## 1          5664.              298.                 1978.                 7324.
## # ℹ 8 more variables: mean_acc_in_air1_mean &lt;dbl&gt;, mean_gmrt1_mean &lt;dbl&gt;,
## #   air_time1_median &lt;dbl&gt;, gmrt_in_air1_median &lt;dbl&gt;, max_x_extension1_median &lt;dbl&gt;,
## #   max_y_extension1_median &lt;dbl&gt;, mean_acc_in_air1_median &lt;dbl&gt;, mean_gmrt1_median &lt;dbl&gt;</code></pre>
<p><code>summarise()</code>函数在不分组的情况下只能返回一行汇总数据。但是有些时候我们需要根据<strong>不同的先决条件</strong>返回不同的汇总数据，比如不同的百分数值返回不同的百分位数，这时就需要用到<code>reframe()</code>函数。具体应用我们在<code>across()</code>函数中会说明。</p>
</div>
<div id="across函数" class="section level3 hasAnchor" number="2.4.10">
<h3><span class="header-section-number">2.4.10</span> across()函数<a href="数据导入导出与预处理.html#across函数" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有时我们只想对特定的若干变量做相同的处理，比如上例<a href="数据导入导出与预处理.html#chapter2-label-summarise">2.4.9</a>中如果想对除<code>air_time1</code>和<code>max_x_extension1</code>以外的数字型变量做均值统计，这时可以考虑<code>across()</code><a href="https://dplyr.tidyverse.org/reference/across.html">函数</a>。</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="数据导入导出与预处理.html#cb380-1" tabindex="-1"></a><span class="co"># 导入数据</span></span>
<span id="cb380-2"><a href="数据导入导出与预处理.html#cb380-2" tabindex="-1"></a>darwin_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/darwin.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 174 Columns: 34
## ── Column specification ───────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (4): ID, class, region, gender
## dbl (30): air_time1, gmrt_in_air1, max_x_extension1, max_y_extension1, mean_acc_in_air1...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="数据导入导出与预处理.html#cb382-1" tabindex="-1"></a>darwin_df <span class="sc">%&gt;%</span> </span>
<span id="cb382-2"><a href="数据导入导出与预处理.html#cb382-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb382-3"><a href="数据导入导出与预处理.html#cb382-3" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb382-4"><a href="数据导入导出与预处理.html#cb382-4" tabindex="-1"></a>    <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="co"># 设置百分数值</span></span>
<span id="cb382-5"><a href="数据导入导出与预处理.html#cb382-5" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb382-6"><a href="数据导入导出与预处理.html#cb382-6" tabindex="-1"></a>      <span class="fu">where</span>(is.numeric) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">c</span>(<span class="st">&quot;air_time1&quot;</span>, <span class="st">&quot;max_x_extension1&quot;</span>), <span class="co"># 遍历非 air_time1 和 max_x_extension1 的数字型变量</span></span>
<span id="cb382-7"><a href="数据导入导出与预处理.html#cb382-7" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">quantile</span>(.x, prob, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co"># 基于prob的百分数值，计算各变量的百分位数</span></span>
<span id="cb382-8"><a href="数据导入导出与预处理.html#cb382-8" tabindex="-1"></a>    )</span>
<span id="cb382-9"><a href="数据导入导出与预处理.html#cb382-9" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##    prob gmrt_in_air1 max_y_extension1 mean_acc_in_air1 mean_gmrt1
##   &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;
## 1 0.375         174.            6124             0.218       161.
## 2 0.625         359.            8298.            0.443       294.</code></pre>
</div>
<div id="日期处理" class="section level3 hasAnchor" number="2.4.11">
<h3><span class="header-section-number">2.4.11</span> 日期处理<a href="数据导入导出与预处理.html#日期处理" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>由于日期通常在导入数据时会被自动定义为字符型（可以先使用<code>str()</code>函数查看变量类型），所以需要使用<code>parse_datetime()</code><a href="https://readr.tidyverse.org/reference/parse_datetime.html">函数</a>将字符型日期转换成<strong>POSIXct</strong>形式。在表示日期形式时，需要了解各字母符号的含义，主要内容如下：</p>
<li>
<strong>年</strong>的表示：<code>%Y</code>为四位数的年份，<code>%y</code>为两位数的年份。
</li>
<li>
<strong>月</strong>的表示：<code>%m</code>为两位数的月份。
</li>
<li>
<strong>日</strong>的表示：<code>%d</code>为两位数的日期。
</li>
<li>
<strong>时</strong>的表示：<code>%H</code>为两位数的小时数。
</li>
<li>
<strong>分</strong>的表示：<code>%M</code>为两位数的分钟数。
</li>
<li>
<strong>秒</strong>的表示：<code>%S</code>为两位数的秒数。
</li>
<p>比如 “23/11/2023 14:33:06” 可以表示为 “%d/%m/%Y %H:%M:%S”。</p>
<p>要计算两个日期之间的天数差，可以使用<code>difftime()</code>函数，并可以使用<code>time_length()</code>函数基于天数差计算月数或者年数差。</p>
<p>如果需要单独提取年、月、日数据，可以使用<code>year()</code>、<code>month()</code>、<code>day()</code>函数或者<code>format()</code>函数。</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="数据导入导出与预处理.html#cb384-1" tabindex="-1"></a><span class="co"># 创建数据框</span></span>
<span id="cb384-2"><a href="数据导入导出与预处理.html#cb384-2" tabindex="-1"></a>df_date <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb384-3"><a href="数据导入导出与预处理.html#cb384-3" tabindex="-1"></a>  <span class="at">ID =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb384-4"><a href="数据导入导出与预处理.html#cb384-4" tabindex="-1"></a>  <span class="at">birthday =</span> <span class="fu">c</span>(<span class="st">&quot;1958-12-01&quot;</span>, <span class="st">&quot;1954-10-01&quot;</span>, <span class="st">&quot;1956-09-20&quot;</span>),</span>
<span id="cb384-5"><a href="数据导入导出与预处理.html#cb384-5" tabindex="-1"></a>  <span class="at">testday =</span> <span class="st">&quot;2022-05-06&quot;</span></span>
<span id="cb384-6"><a href="数据导入导出与预处理.html#cb384-6" tabindex="-1"></a>)</span>
<span id="cb384-7"><a href="数据导入导出与预处理.html#cb384-7" tabindex="-1"></a></span>
<span id="cb384-8"><a href="数据导入导出与预处理.html#cb384-8" tabindex="-1"></a><span class="co"># 检查变量类型，日期都是字符型</span></span>
<span id="cb384-9"><a href="数据导入导出与预处理.html#cb384-9" tabindex="-1"></a><span class="fu">str</span>(df_date)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3 obs. of  3 variables:
##  $ ID      : int  1 2 3
##  $ birthday: chr  &quot;1958-12-01&quot; &quot;1954-10-01&quot; &quot;1956-09-20&quot;
##  $ testday : chr  &quot;2022-05-06&quot; &quot;2022-05-06&quot; &quot;2022-05-06&quot;</code></pre>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="数据导入导出与预处理.html#cb386-1" tabindex="-1"></a>df_date <span class="sc">%&gt;%</span> </span>
<span id="cb386-2"><a href="数据导入导出与预处理.html#cb386-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb386-3"><a href="数据导入导出与预处理.html#cb386-3" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(birthday,testday), <span class="sc">~</span><span class="fu">parse_datetime</span>(.x, <span class="st">&quot;%Y-%m-%d&quot;</span>)), <span class="co"># 需要将日期从字符型转换成日期类型</span></span>
<span id="cb386-4"><a href="数据导入导出与预处理.html#cb386-4" tabindex="-1"></a>    <span class="at">diff_days =</span> <span class="fu">difftime</span>(testday, birthday, <span class="at">units=</span><span class="st">&quot;days&quot;</span>), <span class="co"># 计算日期间的天数差</span></span>
<span id="cb386-5"><a href="数据导入导出与预处理.html#cb386-5" tabindex="-1"></a>    <span class="at">diff_year =</span> <span class="fu">time_length</span>(diff_days, <span class="st">&quot;years&quot;</span>), <span class="co"># 计算日期间的年数差</span></span>
<span id="cb386-6"><a href="数据导入导出与预处理.html#cb386-6" tabindex="-1"></a>    <span class="at">birth_year =</span> <span class="fu">year</span>(<span class="fu">ymd</span>(birthday)), <span class="co"># 提取出生年份</span></span>
<span id="cb386-7"><a href="数据导入导出与预处理.html#cb386-7" tabindex="-1"></a>    <span class="at">test_year =</span> <span class="fu">format</span>(testday, <span class="st">&quot;%Y&quot;</span>) <span class="co"># 提取测试年份</span></span>
<span id="cb386-8"><a href="数据导入导出与预处理.html#cb386-8" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>##   ID   birthday    testday  diff_days diff_year birth_year test_year
## 1  1 1958-12-01 2022-05-06 23167 days  63.42779       1958      2022
## 2  2 1954-10-01 2022-05-06 24689 days  67.59480       1954      2022
## 3  3 1956-09-20 2022-05-06 23969 days  65.62355       1956      2022</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="基本介绍.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/LXHe/a-quick-start-on-data-analysis-in-r/blob/main/02-data-preprocess.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["a-quick-start-on-data-analysis-in-r.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
